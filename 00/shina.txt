С.М. Блохнин










Шина ISA персонального компьютера 

IBM PC/AT





























ПК “Сплайн”
Москва, 1992 год

Оглавление

Глава 1 Введение ..................................................... 4
	Соглашение о терминах и обозначениях ........................... 5
	Виды устройств, работающих на шине ISA ......................... 5

Глава 2 Характеристики задатчиков на шине ...........................  9
	Центральный процессор .........................................  9
	Контроллер ПДП ................................................  9
	Внешняя плата ................................................. 10
		Режим задатчика шины .................................... 10  
	Режим прямого доступа к памяти ................................ 11
		Обычный доступ к внешней плате как к памяти или устрой-       
		ству ввода/вывода ....................................... 13
	Режим сброса .................................................. 13
	Контроллер регенерации памяти ..................................13

Глава 3 Общее описание шины ......................................... 21
	Адресное пространство при обращении к памяти .................. 21	Адресное пространство для устройств ввода/вывода .............. 21
	Структура прерывания .......................................... 22
	Перестановщик байтов .......................................... 22

Глава 4 Описание сигналов на шине ISA ............................... 25
	Сигналы адреса ................................................ 25
		SA<19..0> [8][8/16] ..................................... 25
		LA<23..17> [8/16] ....................................... 25
		-SBHE [8/16] ............................................ 26
		BALE [8][8/16] .......................................... 26
		AEN [8][8/16] ........................................... 27
		SD<7..0> [8][8/16] и SD<15..8> [8/16] ................... 27
	Командные сигналы ............................................. 27
		-MEMR [8/16] и -SMEMR [8][8/16] ......................... 28
		-MEMW [8/16] и -SMEMW [8][8/16] ......................... 28
		-I/OR [8][8/16] ......................................... 28
		-I/OW [8][8/16] ......................................... 29
		-MEM CS16 [8/16] ........................................ 29
		-I/O CS16 [8/16] ........................................ 29
		I/O CH RDY [8][8/16] .................................... 30
		-0WS [8][8/16] .......................................... 30
		-REFRESH [8][8/16] ...................................... 31
	Центральные сигналы управления ................................ 31
		-MASTER [8/16] .......................................... 31
		-I/O CH CK [8][8/16] .................................... 32
		RESET DRV [8][8/16] ..................................... 32
		SYSCLK [8][8/16] ........................................ 32
		OSC [8][8/16] ........................................... 32
	Сигналы прерывания ............................................ 33
		IRQ<15,14,12,11,10> [8/16] IRQ<9,7..3> [8][8/16] ........ 33
	Сигналы режима ПДП ............................................ 33
		DRQ<7..5,0> [8/16] DRQ<9,7..3> [8][8/16] ................ 33
		-DACK<7..5,0> [8/16] -DACK<3,2,1> [8][8/16] ............. 34
		T/C [8][8/16] ........................................... 34
	Питание ....................................................... 34

Глава 5 Циклы шины .................................................. 35
	Цикл доступа к ресурсу ........................................ 35
		Цикл Доступа к Ресурсу - 0 тактов ожидания ...............36
		Цикл Доступа к Ресурсу - Нормальный цикл ................ 36
		Цикл Доступа к Ресурсу - Удлиненный цикл ................ 36
	Цикл Регенерации .............................................. 36
		Цикл Регенерации - Нормальный Цикл ...................... 37
		Цикл Регенерации - Удлиненный Цикл ...................... 37
	Цикл ПДП ...................................................... 37
		Цикл ПДП - Нормальный Цикл .............................. 38
		Цикл ПДП - Удлиненный Цикл .............................. 38
	Цикл Захвата Шины ............................................. 38

Глава 6 Временные диаграммы ......................................... 40

Глава 7 Характеристики соединителей на шине ......................... 53
	Назначение выводов соединителей, устанавливаемых в слоты ...... 53
	Электрические характеристики сигналов ......................... 54
	Напряжения и токи по цепям синалов на шине .................... 54
	Дополнительные требования к приемникам и передатчикам на
	внешних платах ................................................ 55
	Нагрузочные резисторы на шине ................................. 55
	Механические характеристики внешней платы ..................... 56
	Рекомендуемые схемы приема/выборки сигналов на шине ........... 60

Список литературы ................................................... 64

 	 
  	


























Глава 1                                                                                 Введение


	
	Шина ISA (Industrial Standart Architecture) является фактически стандартной шиной для персональных компьютеров типа IBM PC/AT и совместимых с ними. Шина EISA, с которой ряд фирм уже начал выпуск персональных компьютеров, в нашей стране практически пока не нашла применения, ввиду отсутствия достаточного числа компьютеров с такой шиной.

	В этой книге подробно объясняются все сигналы на шине, включая полные временные диаграммы, причем временные диаграммы приводятся как для обычных режимов работы шины, так и для циклов прямого доступа к памяти, ее регенерации, а также диаграмма цикла захвата шины. Кроме этого, приводятся требования к конструктивному исполнению внешних плат, устанавливаемых в компьютер, требования к входным и выходным сигналам для таких плат. Главная цель, которую мы ставили перед собой – дать возможность всем разработчикам дополнительных устройств для компьютеров типа IBM PC/AT успешно проектировать свои платы. К сожалению, нельзя гарантировать, что ваши устройства будут нормально работать абсолютно во всех компьютерах, так как некоторые изготовители компьютеров не всегда выдерживают требования к интерфейсу. В литературе (1) достаточно подробно описана шина ISA и в этой книге использована фирменная документация на шину ISA.

	Основные отличия шины ISA персонального компьютера IBM PC/AT от своей предшественницы – шины компьютера IBM PC/XT заключается в (следующем:
шина AT-компьютеров позволяет использовать на внешних платах как 16-ти разрядные устройства ввода/вывода, так и 16-ти разрядную память;
цикл доступа к 16-ти разрядной памяти на внешней плате может быть выполнен без вставки тактов ожидания;
объем непосредственно адресуемой памяти на внешних платах может достигать 16 Мегабайт;
внешняя плата может становиться хозяином(задатчиком) на шине и самостоятельно осуществлять доступ ко всем ресурсам как на шине, так и на материнской плате.


Особые пометки при изложении

(+) ПРИМЕЧАНИЕ – Специальная информация, заслуживающая пристального внимания

(!) ВНИМАНИЕ! – Важная информация, игнорирование которой может повлечь за собой невозможность нормальной работы созданных вами устройств, а в некоторых случаях и выход из строя компьютера.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ – Информация, на которую следует обратить внимание, если вы разрабатываете свои собственные платы для шины ISA.

(/) РЕКОМЕНДАЦИИ – Рекомендации по аппаратной реализации приема или передачи конкретных сигналов на шине. В приложении 3 также приведены электрические принципиальные схемы, иллюстрирующие некоторые из этих рекомендаций.  


1.1.	Соглашения о терминах и обозначениях


	В этой книге знак –(минус) перед названием сигнала означает, что активный уровень сигнала - логический ноль. Отсутствие знака минус означает, что активный уровень сигнала – логическая единица.

	Для удобства ссылок на какой-либо сигнал будем считать, что сигнал разрешен, если он находится в своем активном состоянии, и что сигнал запрещен, если он находится в пассвном состоянии.

	Большинство сигналов на шине могут легко рассматриваться совместно, поскольку они функционально идентичны; поэтому мы будем использовать несколько способов обозначения сигналов из таких функционально объединенных групп:

когда сигнал будет упоминаться строго индивидуально, то он будет обозначаться так: SA0. 
когда будут упоминаться несколько разрозненных определенных сигналов из группы, то они будут обозначаться так: SA<15,8,0>.
когда будут упоминаться несколько определенных сигналов в каком-либо диапазоне из группы, то они будут обозначаться так: SA<15..8>.
для обозначения всей группы в целом, использкются только буквы из обозначения сигналов в группе. Например, вся шина адреса в пределах первого мегабайта памяти обозначается буквой SA. Это эквивалентно SA<19..0>.

Квадратные скобки [] будут использоваться для указания типа разъема на внешней плате, использующей объясняемый в тексте сигнал. Например, [8] означает, внешнюю плату, имеющую только один 8-ми разрядный разъем, [8/16] означает, что внешняя плата имеет два разъема и, поэтому, может оперировать как 8-ми так и 16-ти разрядными данными.


1.2.	Виды устройств, работающие на шине ISA


При описании шины целесообразно представить компьютер как состоящий из материнской платы (motherboard) и внешних плат, которые взаимодействуют между собой и ресурсами материнской платы через шину. Все пассивные устройства (не могущие стать задатчиками) на шине можно разделить на две группы – память и устройства ввода/вывода (порты). Циклы доступа для каждой из групп отличаются друг от друга как по временных харастеристикам, так и по вырабатываемым на шине сигналам.

Чисто условно, для удобства понимания функционирования шины ISA, будем считать, что на материнской плате компьютера существуют следующие устройства, способные быть владельцами (задатчиками) шины: центральный процессор (ЦП), контроллер прямого доступа в память (ПДП), контроллер регенерации памяти (КРП). Кроме этого, задатчиком на шине может быть и внешняя плата. При выполнении цикла доступа к ресурсам на шине задатчиком может быть только одно из устройств. Рассмотрим подробнее функции этих устройств на шине ISA:


Центральный процессор(ЦП)
является основным задатчиком на шине. По умолчанию именно ЦП будет считаться задатчиком на шине. Контроллер ПДП, а также контроллер регенерации памяти запрещает работу ЦП на время своей работы.


Контроллер ПДП             
это устройство связано с сигналами запроса на режим ПДП и сигналами подтверждения режима ПДП. Активный сигнал запроса на ПДП будет разрешать последующий захват шины контроллером ПДП для передачи данных из памяти в порты вывода или из портов ввода в память.


Контроллер регенерации     
памяти
становится владельцем шины и     генерирует сигналы адреса и чтения памяти для регенерации информации в микросхемах динамической памяти как на материнской плате, так и на внешних платах.


Внешняя плата            
взаимодействует с остальными  устройствами через разъем на шине ISA. Может становиться задатчиком на шине для доступа к памяти или устройствам ввода/вывода.


Кроме этого на материнской плате компьютера имеется ряд устройств, которые не могут быть задатчиками на шине, но тем не менее взаимодействуют с ней. Это следующие устройства:


Часы реального времени
Таймер-счетчик
это устройство состоит из часов реального времени для поддержки даты и времени и таймера, как правило на базе микросхемы    Intel 8254A (отечественный аналог КР1810ВИ54). Один из таймеров-счетчиков этой микросхемы вырабатывает импульсы с периодом 15 микросекунд для запуска контроллера регенерации памяти.


Кросс материнской платы
часть материнской платы, которая  соединяет разъемы шины ISA для подключения внешних плат с другими ресурсами на материнской плате.
Память на материнской
плате 	 	
часть или все микросхемы памяти  прямого  доступа(ОЗУ), используемые для хранения информации ЦП. На внешних платах также могут быть размещены микросхемы дополнительной памяти.


Контроллер прерываний
это устройство связано с линиями запросов прерываний на шине. Прерывания требуют дальнейшего обслуживания ЦП.


Устройства ввода/вывода
часть или все устройства  ввода/вывода(такие как параллельные  или последовательные порты), которые могут размещаться как на материнской плате, так и на внешних платах.


Перестановщик байтов 
данных   						 
это устройство позволяет обмениваться данными между собой 16-ти разрядным и 8-ми разрядным устройствами. 


Архитектура персонального компьютера IBM PC/AT с точки зрения использования шины ISA показана на рисунке 1.1.

Внешние платы, устанавливаемые в разъемы шины, могут быть 8-ми разрядными и/или 16-ти разрядными. 8-ми разрядная плата имеет только один интерфейсный разъем и может оперировать только с 8-ми разрядными данными, и кроме этого, 8-ми разрядный слот также не может быть задатчиком на шине. 16-ти разрядная плата обязательно имеет два интерфейсных разъема – один основной, такой же как в 8-ми разрядных платах, и один дополнительный. Такая плата может оперировать как с 8-ми так и с 16-ти разрядными данными и, кроме того, она может быть задатчиком на шине. Общее число устанавливаемых в разъемах шины плат ограничивается как нагрузочной способностью шины, так и конструктивным исполнением материнской платы. Как правило, допускается устанавливать не более 8(5 16-ти разрядных и три 8-ми разрядных) внешних плат на шину. Такое ограничение вызвано также и относительно небольшим количеством свободных линий запросов на ПДП и запросов на прерывания, имеющихся на шине. 







						




		
                             		




						Внешние платы 8-ми разрядные	





	
Кросс материнской платы
                                          16-разрядные
			
					
                                                       	
	


               	







                     

                 

Рис. 1.1 Архитектура персонального компьютера

















Глава 2.                                Характеристики задатчиков на шине   



2.1. Центральный процессор


Центральный процессор по умолчанию является основным владельцем
шины, контроллер ПДП и контроллер регенерации памяти могут стать задатчиками на шине, только предварительно запретив работу ЦП. Процесс запрещения работы ЦП состоит в выработке сигнала запроса на ПДП и приема сигнала подтверждения ПДП.

	Центральный процессор может быть источником как 16-ти разрядных операций, так и 32-х разрядных. Когда ЦП является 16-ти разрядным ресурсом, он может выполнять операции как с 16-ти, так и с 8-ми разрядными ресурсами на шине. При выполнении ЦП команды, оперирующей с 16-ти разрядными данными, если ресурс доступа 8-ми разрядный, то специальными аппаратными средствами на материнской плате в этом случае выполняются два цикла доступа. Если же ЦП является 32-х разрядным, то аппаратно на материнской плате компьютера один 32-х разрядный цикл работы ЦП с внешним ресурсом должен быть преобразован в два индивидуальных 16-ти разрядных цикла доступа.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если ЦП является задатчиком на шине, то внешние платы могут функционировать только в режиме памяти или устройства ввода/вывода.

	В таблице 2-1 показано для режима захвата шины центральным процессором, какие сигналы какими устройствами вырабатываются, а также какое устройство для данного сигнала является приемником сигнала(П), а какое источником сигнала(И).


2.2. Контроллер ПДП


	Сигналы для поддержки режима ПДП подключены непосредственно к контроллеру ПДП, выполненному, как правило, на микросхеме Intel 8237A (отечественный аналог КР1810ВТ37А). Когда режим ПДП запрашивается каким-либо устройством (хотя бы один из сигналов DRQ становится активным), контроллер ПДП осуществляет захват шины у ЦП. Выдача контроллером ПДП соответствующего сигнала –DACK означает, что он начал передачу данных. Циклы ПДП не будут выполняться на шине, если сигнал –MASTER будет разрешен с какой-либо внешней платы.

	Если запрос на ПДП требуется устройству ввода/вывода, то следует учесть, что каналы 0..3 ПДП поддерживают передачу только 8-ми разрядных данных; все данные должны передаваться только по линиям SD<7..0>. Перестановка байтов в этом случае выполняется аппаратно на материнской плате в соответствии с сигналами SA0 и –SBHE. Такая перестановка может потребоваться, например, пр передаче данных из старшего байта 16-ти разрядной памяти в 8-ми разрядный порт. Каналы ПДП 5..7 поддерживают передачу только 16-ти разрядных данных; все данные должны передаваться как 16-ти разрядные по линиям SD<15..0>. Память, участвующая в работе в режиме ПДП по этим каналам, должна быть только 16-ти разрядной, а перестановщик байтов на материнской плате не будет корректировать несоответствие размеров данных.

(+) ПРИМЕЧАНИЕ: 8-ми разрядная память со своей стороны может передавать данные в режиме ПДП только 8-ми разрядным устройствам ввода/вывода; использование 8-ми разрядной памяти с 16-ти разрядными устройствами ввода/вывода не допускается

(!) ВНИМАНИЕ! Контроллер регенерации памяти не может захватить шину до тех пор, пока контроллер ПДП ей владеет. Это означает, что любой цикл ПДП не должен превышать 15 микросекунд. В противном случае может произойти потеря информации в микросхемах динамической памяти.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Сигналы запроса и подтверждения режима ПДП заведены на все внешние платы и эти сигналы вырабатываются обычными ТТЛ выходами, поэтому все внешние платы должны использовать и анализировать различные каналы ПДП. В противном случае возможен конфликт внешних плат между собой или с устройствами на материнской плате.

	Внешние слоты могут быть или памятью прямого доступа или устройством ввода/вывода, когда они взаимодействуют с контроллером ПДП.

	В таблице 2-2. Показано для режима захвата шины контроллером ПДП, какие сигналы какими устройствами вырабатываются, а также какое устройство для данного сигнала является приемником сигнала (П), а какое источником сигнала (И).


2.3.	Внешняя плата


Внешние платы могут функционировать в 5 различных режимах: задатчика шины, памяти и устройств ввода/вывода прямого доступа, памяти и устройств ввода/вывода, регенерации памяти и сброса. Платы могут поддерживать любую комбинацию из первых четырех режимов; сигналу сброса должны подчиниться все платы одновременно.

2.3.1.	Режим задатчика шины

Только 16-ти разрядные платы с двумя интерфейсными разъемами могут становиться задатчиками на шине. Для захвата шины внешняя плата должна разрешить сигнал –DRQ и, получив сигнал –DACK от контроллера ПДП, разрешить сигнал –MASTER. На этом процедура захвата шины заканчивается.

Внешняя плата, захватив шину, может выполнять любые циклы доступа, так же как центральный процессор. Единственное ограничение – невозможность выполнять циклы ПДП, так как все интерфейсные сигналы, управляющие работой контроллера ПДП, заведены на материнскую плату и не могут быть использованы контроллером ПДП, находящимся на внешней плате. Когда внешняя плата является задатчмком на шине, контроллер ПДП запрещает сигнал AEN и это позволяет устройствам ввода/вывода нормально дешифровать адрес и быть доступными для внешней платы. При запрещенном сигнале AEN циклы передачи ПДП невозможны (подробнее в разделе описания сигнала AEN, в главе 4). Кроме этого, циклы ПДП не могут быть выполнены на шине также и потому, что у контроллера ПДП канал, через который был осуществлен захват шины, занят, а другие каналы контроллера ПДП не могут быть использованы до освобождения ранее занятого, т.е. до освобождения шины захватившей ее внешней платой.

(+) ПРИМЕЧАНИЕ: Программное обеспечение, поддерживающее работу внешней платы в качестве задатчика шины, должно обеспечивать использование каналов ПДП только в режиме каскадирования. В противном случае внешняя плата не сможет осуществить захват шины.
Внешняя плата начинает любой цикл доступа к ресурсам на шине как 16-ти разрядная, однако если сигнал –MEM CS16 или –I/O CS16 не будет разрешен, цикл будет завершен как 8-ми разрядный. При этом перестановщик байтов на материнской плате будет определять, по каким линиям данных (SD<15..8> или SD<8..0>) передается байт информации, исходя из анализа сигналов –SBEH и SA0. 

(!) ВНИМАНИЕ! Захватившая шину внешняя плата обязана не реже чем через 15 микросекунд вырабатывать сигнал –REFRESH для запроса контроллеру регенерации на регенерацию памяти. Контроллер регенерации при выполнении цикла регенерации памяти вырабатывает сигналы адреса, команд и анализирует сигнал IO CH RDY, а внешняя плата, выработавшая сигнал –REFRESH, по завершении цикла регенерации снимает этот сигнал и продолжает оставаться задатчиком на шине. При необходимости выполнить несколько циклов регенерации сигнал –REFRESH может быть удержан внешней платой на все время требуемого количества циклов регенерации.

Контроллер регенерации памяти не может захватить шину сам до тех пор, пока контроллер ПДП (а именно через него внешняя плата становится задатчиком на шине) не освободит ее на время регенерации по сигналу –REFRESH.

	В таблице 2-3. показано для режима захвата шины внешней платой, какие сигналы какими устройствами вырабатываются, а также какое устройство для данного сигнала является приемником сигнала(П), а какое источником сигнала(И).


2.4	  Режим прямого доступа к памяти


Внешняя плата может работать в режиме ПДП только в том случае, если контроллер ПДП является задатчиком на шине. В режиме прямого доступа к памяти данные всегда передаются между устройством ввода/вывода и памятью на внешней плате. В режиме прямого доступа к устройству ввода/вывода данные передаются между памятью и устройством ввода/вывода на внешней плате. Внешняя плата, отвечающая на шине как 8-ми или 16-ти разрядное устройство, должна соответственно использовать 8-ми или 16-ти разрядное устройство, должна соответственно использовать 8-ми или 16-ти разрядные каналы контроллера ПДП. В таблице 2-2. показано состояние сигналов на шине для режима ПДП.

(!) ВНИМАНИЕ! Следует специально обратить внимание на некоторые особенности при выполнении циклов передачи данных между 8-ми разрядными устройствами ввода/вывода и 16-ти разрядной памяти на внешней плате. Во-первых, внешняя плата должна анализировать сигналы –SBEH и SA0 для правильного определения передаваемых данных. Во-вторых, при записи в УВВ из памяти на внешней плате перестановщик байтов на материнской плате будет определять, по какой половине шины данны (SD<15..8> или  SD<7..0>) следует направить байт; внешняя плата после анализа –SBEH и SA0 должна определить, по какой половине шине данных ей направить байт данных. В-третьих, при чтении УВВ в память на внешней плате перестановщик байтов направляет в память байт данных также либо по старшей половине шины данных SD<15..8>, либо по младшей половине SD<7..0>. Внешняя плата по сигналам –SBEH и SA0 должна определять, когда следует переводить в третье состояние свои выходы по младшей половине шины данных SD<7..0> во избежание столкновений на шине.

Внешняя плата может как 16-ти разрядная память обмениваться в режиме ПДП как с 8-ми разрядными устройствами ввода/вывода, так и с 16-ти разрядными. Но, если внешняя плата является 8-ми разрядной памятью, то в режиме ПДП она может обмениваться только с 8-ми разрядными устройствами ввода/вывода. Другая особенность относится к тому случаю, когда контроллер ПДП выполняет запись данных в 8-ми разрядное устройство вывода на внешней плате из 16-ти разрядной памяти. Если такая внешняя плата установлена в 16-ти разрядный слот и может работать в 16-ти разрядном режиме, она должна поддерживать старшую половину шиныданных SD<15..8> в третьем состоянии во избежание столкновения сигналов на шине. (Для более подробной информации следует обратиться к разделу 3.4.)

(!) ВНИМАНИЕ! Когда контроллер ПДП является задатчиком на шине, он игнорирует сигнал –0WS, поэтому если внешняя плата используется как 16-ти разрядная память и обмен с ней выполняется контроллером ПДП, применение быстрых микросхем памяти в таких платах лишено смысла.

2.4.1	Обычный доступ к внешней плате как к памяти или устройству ввода/вывода

Внешняя плата становится обычным ресурсом памяти или ввода/вывода, если задатчиком на шине является центральный процессор или другая внешняя плата.
       	
(!) ВНИМАНИЕ! Существуют особенности такого использования внешней платы, если она устанавливается в [8/16] слот, а участвует в обмене данными как 8-ми разрядная память или УВВ в течении всего цикла доступа. При чтении данных в такую внешнюю плату перестановщик байтов будет переставлять данные между шинами SD<15..8> или SD<7..0> для правильного приема данных внешней платой. Внешняя плата при этом должна поддерживать свои выходы SD<15..8> в третьем состоянии, так как иначе неизбежно столкновение сигналов на шине данных. (Для более подробной информации следует обратиться к разделу 3.4.).
Когда некоторые внешние платы становятся задатчиками на шине, они могут игнорировать сигнал I/O CH RDY или –0WS и выполнять цикл доступа как цикл обращения к 8-ми или 16-ти разрядной памяти. Но любые внешние сигналы обязаны возвращать задатчику на шине ISA эти сигналы при необходимости, так как если центральный процессор является задатчиком на шине, то он использует эти сигналы для определения продолжительности цикла доступа.


2.5	  Режим сброса


Все внешние платы оказываются в режиме сброса при разрешенном сигнале RESET DRV; иначе этот режим невозможен. Все выходы с тремя состояниями на плате должны быть в третьем состоянии и все выходы с открытым коллектором должны быть в состоянии логической единицы на время не менее 500 наносекунд после разрешения сигнала RESET DRV и быть готовыми к выполнению циклов доступа на шине. Любые операции на шине возможны только после завершения сигнала RESET DRV.






2.6.	Контроллер регенерации памяти


Контроллер регенерации памяти выполняет циклы чтении памяти по специальным адресам на материнской плате и внешних платах для регенерации информации в микросхемах динамической памяти. Каждые 15 микросекунд контроллер пытается овладеть шиной для запуска цикла регенерации. Если в этот момент задатчиком на шине является центральный процессор, то он освобождает шину для контроллера регенераций. Если в этот момент шина захвачена внешней платой, то контроллер регенерации выполнит цикл регенерации только при выработке внешней платой сигнала –REFRESH. Если в этот момент задатчиком на шине являлся контроллер ПДП, то до освобождения им шины цикл регенерации не может быть выполнен.

Когда выполняется цикл регенерации, контроллер регенерации вырабатывает сигналы адреса SA<7..0> с одним из 256 возможных адресов регенерации. Другие адресные линии неопределены и могут находиться в третьем состоянии. Этот цикл может выполняться с задержкой по сигналу I/O CH RDY с разрешенными сигналами –SMEMR и –MEMR.

(!) ВНИМАНИЕ! Циклы регенерации должны выполняться каждые 15 микросекунд для перебора всех 256 адресов за 4 миллисекунды. Если это условие не выполняется, данные, хранящиеся в динамической памяти, могут быть утеряны.

В таблице 2-4. показано для режима захвата шины контроллером регенерации, какие сигналы какими устройствами вырабатываются, а также какое устройство для данного сигнала является приемником сигнала(П), а какое источником сигнала(И).

В таблице 2-5. показано для режима захвата шины внешней платой, которая при этом разрешила сигнал –REFRESH, какие сигналы какими устройствами вырабатываются, а также какое устройство для данного сигнала является приемником сигнала(П), а какое источником сигнала(И).    


Табл. 2-1. Задатчик на шине – центральный процессор

   Сигнал

  
  ЦП
  
  ВП
 
 ПДП
 
 КРП
 
 ОЗУ

 УВВ
Типы источников
 
 AEN
 BALE
 -DACK
 DRQ(1)
 -I/O CH CK
 I/O CH RDY
 -I/O CS16
 -I/OR
 -I/OW
 IRQ(2)
 LA
 -MASTER
 -MEM CS16
 -MEMR
 -MEMW
 OSC
 -REFRESH
 RESET DRV(3)
 SA
 -SBHE(4)
 SD
 -SMEMR
 -SMEMW
 SYSCLK
 T/C
 -OWS

  
  -
  И
  -
  -
  П
  П
  П
  И
  И
  П
  И
  -
  П
  И
  И
  И
  -
  И
  И
  И
 И/П
 (5)
 (5)
  И
  -
  П


  
  П
  П
  П
  И
  И
  И
  И
  П
  П
  И
  П
  -
  И
  П
  П
  П
  -
  П
  П
  П
 И/П
  П
  П
  П
  -
  И              
  
  И
  -
  И
  П
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  П
  -
  -
  -
  -
  -
  П
  -
  -
  
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  - 
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  
  -
  П
  -
  -
  И
  И
  -
  -
  -
  -
  П
  -
  И
  П
  П
  -
  -
  -
  П
  П
 И/П
  П
  П
  П
  -
  И
  
  П     
  П
  П
  И
  И
  И
  И
  П
  П
  И
  -
  -
  -
  -
  -
  -
  -
  П
  П
  П
 И/П
  -
  -
  -
  -
  -
  


 
 ТТЛ
 ТТЛ 
 ТТЛ 
 ТТЛ
 ОК
 ОК
 ОК
 ТРИ
 ТРИ
 ТТЛ
 ТРИ
 ОК
 ОК
 ТРИ
 ТРИ
 ТТЛ
 ОК
 ТТЛ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТТЛ
 ОК   

	В этой таблице приняты следующие условные обозначения: центральный процессор – ЦП, внешние платы – ВП, контроллер ПДП  - ПДП, контроллер регенерации памяти – КРП, ОЗУ на материнской плате – ОЗУ, устройства ввода/вывода на материнской плате – УВВ.

	Типы источников сигналов обозначаются так: ТТЛ – выход микросхемы транзисторно-транзисторной логики, ОК – открытый коллекторный выход, ТРИ – выход микросхемы с тремя допустимыми состояниями на выходе.

	Знаком “-” показывается, что этот сигнал для данного устройства либо запрещен, либо для этого устройства он безразличен.

(1) – DRQ может быть выдан на шину, но он не будет восприниматься как активный, до тех пор, пока контроллер ПДП является задатчиком на шине.
(2) – эти сигналы принимаются ЦП через контроллер прерываний,но анализируются им только тогда, когда ЦП становится задатчиком на шине.

(3) – этот сигнал может быть выработан в любое произвольное           время и он всегда будет действующим.

(4) – этот сигнал всегда принимается и анализируется перестановщиком байтов данных.

(5) – вырабатывается устройствами на материнской плате в том случае, если требуется обращение к памяти в пределах 1-го мегабайта адресного пространства.
 
	                   
                        Табл.2-2. Задатчик на шине – контроллер ПДП

  Сигнал

  
  ЦП
 
  ВП

 ПДП

 КРП

 ОЗУ

 УВВ
Типы источников
 
 AEN
 BALE
 -DACK
 DRQ(1)
 -I/O CH CK
 I/O CH RDY
 -I/O CS16
 -I/OR
 -I/OW
 IRQ(2)
 LA
 -MASTER
 -MEM CS16
 -MEMR
 -MEMW
 OSC
 -REFRESH
 RESET DRV(3)
 SA
 -SBHE(4)
 SD
 -SMEMR
 -SMEMW
 SYSCLK
 T/C
 -OWS

  
  -
 (6)
  -
  -
  П
  -
  -
  -
  -
  П
  -
  -
  -
  -
  -
  И
  -
  И
  -
  -
  -
 (5)
 (5)
  И
  -
  -


  
  П
  П
  П
  И
  И
  И
  Х
  П
  П
  И
  П
  -
  Х
  П
  П
  П
  -
  П
  П
  П
 И/П
  П
  П
  П
  П
  -              
  
  И
  -
  И
  П
  -
  П
  Х
  И
  И
  -
  И
  -
  Х
  И
  И
  -
  -
  П
  И
  И
  -
  -
  -
  П
  И
  -
  
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  - 
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  
  -
  П
  -
  -
  И
  И
  -
  -
  -
  -
  П
  -
  Х
  П
  П
  -
  -
  -
  П
  П
 И/П
  П
  П
  П
  -
  -
  
  П     
  П
  П
  И
  И
  И
  Х
  П
  П
  И
  -
  -
  -
  -
  -
  -
  -
  П
  П
  -
 И/П
  -
  -
  -
  П
  -
  


 
 ТТЛ
 ТТЛ 
 ТТЛ 
 ТТЛ
 ОК
 ОК
 ОК
 ТРИ
 ТРИ
 ТТЛ
 ТРИ
 ОК
 ОК
 ТРИ
 ТРИ
 ТТЛ
 ОК
 ТТЛ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТТЛ
 ОК   

	В этой таблице приняты следующие условные обозначения: центральный процессор – ЦП, внешние платы – ВП, контроллер ПДП – ПДП, контроллер регенерации памяти – КРП, ОЗУ на материнской плате – ОЗУ, устройства ввода/вывода на материнской плате – УВВ. Типы источников сигналов обозначаются так: ТТЛ – выход микросхемы транзисторно- транзисторной логики, ОК – открытый коллекторный выход, ТРИ – выход микросхемы с тремя допустимыми состояниями на выходе.

	Знаком “-” показывается, что этот сигнал для данного устройства либо запрещен, либо для этого устройства он безразличен.

	Знак “X” означает, что сигнал может быть выработан этим устройством, но он будет игнорироваться другими устройствами.

(1)– DRQ может быть выдан на шину, но он не будет восприниматься как активный, до тех пор, пока контроллер ПДП является задатчиком на шине.
 
(2) – эти сигналы принимаются ЦП через контроллер прерываний, но анализируются им только тогда, когда ЦП становится задатчиком на шине.

(3) – этот сигнал может быть выработан в любое произвольное время и он всегда будет действующим.

(4) – этот сигнал всегда принимается и анализируется перестановщиком байтов данных.

(5) – вырабатывается устройствами на материнской плате в том случае, если требуется обращение к памяти в пределах 1-го мегабайта адресного пространства.

(6) – вырабатывается как разрешенный материнской платой для всего цикла. 


                         Табл.2-3. Задатчик на шине – внешняя плата

   Сигнал

  
  ЦП

 ВПЗ
  
  ВП
 
 ПДП
 
 КРП
 
 ОЗУ
 
 УВВ
 AEN
 BALE
 -DACK
 DRQ(1)
 -I/O CH CK
 I/O CH RDY
 -I/O CS16
 -I/OR
 -I/OW
 IRQ(2)
 LA
 -MASTER
 -MEM CS16
 -MEMR
 -MEMW
 OSC
 -REFRESH
 RESET DRV(3)
 SA
 -SBHE(4)
 SD
 -SMEMR
 -SMEMW
 SYSCLK
 T/C
 -OWS
  -
 (6)
  -
  -
  П
  -
  -
  -
  -
  П
  -
  -
  -
  -
  -
  И
  -
  И
  -
  -
  -
 (5)
 (5)
  И
  -
  -


  -
  -
  П
  И
  И
  П
  П
  И
  И
  И
  И
  И
  П
  И
  И
  П
  -
  П
  И
  И
 И/П
  -
  -
  П
  -
  - 
  



  П
  П
  П
  -
  И
  И
  И
  П
  П
  И
  П
  -
  И
  П
  П
  П
  -
  П
  П
  П
 И/П
  П
  П
  П
  -
  -              
  И
  -
  И
  И
  -
  -
  -
  -
  -
  -
  -
  П
  -
  -
  -
  -
  -
  П
  -
  -
  -
  -
  -
  П
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  - 
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  -
  П
  -
  -
  И
  И
  -
  -
  -
  -
  П
  -
  И
  П
  П
  -
  -
  -
  П
  П
 И/П
  П
  П
  П
  -
  -
  П     
  П
  П
  И
  И
  И
  И
  П
  П
  И
  -
  -
  -
  -
  -
  -
  -
  П
  П
  -
 И/П
  -
  -
  П
  -
  -
  



	В этой таблице приняты следующие условные обозначения: центральный процессор – ЦП, внешняя плата, захватившая шину – ВПЗ, внешние платы – ВП, контроллер ПДП – ПДП, контроллер регенерации памяти – КРП, ОЗУ на материнской плате – ОЗУ, устройства ввода/вывода на материнской плате – УВВ.

	Знаком “-” показывается, что этот сигнал для данного устройства либо запрещен, либо для этого устройства он безразличен.

(1)– DRQ может быть выдан на шину, но он не будет восприниматься как активный, до тех пор, пока контроллер ПДП является задатчиком на шине.
 
(2) – эти сигналы принимаются ЦП через контроллер прерываний, но анализируются им только тогда, когда ЦП становится задатчиком на шине.

(3) – этот сигнал может быть выработан в любое произвольное время и он всегда будет действующим.

(4) – этот сигнал всегда принимается и анализируется перестановщиком байтов данных.

(5) – вырабатывается устройствами на материнской плате в том случае, если требуется обращение к памяти в пределах 1-го мегабайта адресного пространства.

(6) – вырабатывается как разрешенный материнской платой для всего цикла. 


             Табл. 2-4. Задатчик на шине – контроллер регенерации

  Сигнал
  
  ЦП
  
  ВП
 
 ПДП
 
 КРП
 
 ОЗУ
 
 УВВ
Типы источников
 
 AEN
 BALE
 -DACK
 DRQ(1)
 -I/O CH CK
 I/O CH RDY
 -I/O CS16
 -I/OR
 -I/OW
 IRQ(2)
 LA
 -MASTER
 -MEM CS16
 -MEMR
 -MEMW
 OSC
 -REFRESH
 RESET DRV(3)
 SA(7..0)
 SA(15..8)
 -SBHE(4)
 SD
 -SMEMR
 -SMEMW
 SYSCLK
 T/C
 -OWS

  
  -
 (6)
  -
  -
  П
  -
  Х
  -
  -
  П
  -
  -
  Х
  -
  -
  И
  -
  И
  -
  -
  -
  -
 (5)
  -
  И
  -
  -


  
  Х
  П
  П
  И
  И
  И
  Х
  -
  -
  И
  -
  -
  Х
  П
  -
  П
  П
  П
  П
  -
  -
  -
  П
  -
  П
  -
  -              
  
  Х
  -
  И
  П
  -
  -
  Х
  -
  -
  -
  -
  -
  Х
  -
  -
  -
  -
  П
  -
  -
  -
  -
  -
  -
  П
  -
  -
  
  -
  -
  -
  -
  -
  П
  Х
  -
  -
  -
  -
  -
  Х
  И 
  -
  -
  И
  -
  И
  -
  -
  -
  -
  -
  -
  -
  -
  
  -
  П
  -
  -
  И
  И
  Х
  -
  -
  -
  -
  -
  Х
  П
  -
  -
  П
  -
  П
  -
  -
  -
  П
  -
  П
  -
  -
  
  Х     
  П
  П
  И
  И
  И
  Х
  -
  -
  И
  -
  -
  Х
  -
  -
  -
  -
  П
  П
  -
  -
  -
  -
  -
  -
  -
  -
  


 
 ТТЛ
 ТТЛ 
 ТТЛ 
 ТТЛ
 ОК
 ОК
 ОК
 ТРИ
 ТРИ
 ТТЛ
 ТРИ
 ОК
 ОК
 ТРИ
 ТРИ
 ТТЛ
 ОК
 ТТЛ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТТЛ
 ОК   

В этой таблице приняты следующие условные обозначения: центральный процессор – ЦП, внешние платы – ВП, контроллер ПДП – ПДП, контроллер регенерации памяти – КРП, ОЗУ на материнской плате – ОЗУ, устройства ввода/вывода на материнской плате – УВВ. Типы источников сигналов обозначаются так: ТТЛ – выход микросхемы транзисторно транзисторной логики, ОК – открытый коллекторный выход, ТРИ – выход микросхемы с тремя допустимыми состояниями на выходе.

Знаком “-” показывается, что этот сигнал для данного устройства либо запрещен, либо для этого устройства он безразличен.

Знак “X” означает, что сигнал может быть выработан этим устройством, но он будет игнорироваться другими устройствами.

(1) – DRQ может быть выдан на шину, но он не будет восприниматься как активный, до тех пор, пока контроллер ПДП является задатчиком на шине.

	(2) – эти сигналы принимаются ЦП через контроллер прерываний, но анализируются им только тогда, когда ЦП становится задатчиком на шине.

	(3) – этот сигнал может быть выработан в любое произвольное время и он всегда будет действующим.

	(4) – этот сигнал всегда принимается и анализируется перестановщиком байтов данных.

	(5) – вырабатывается устройствами на материнской плате в том случае, если требуется обращение к памяти в пределах 1-го мегабайта адресного пространства.

	(6) – вырабатывается как разрешенный материнской платой для всего цикла. 

                                      
    Табл. 2-5

  Сигнал
  
  ЦП
  
  ВП
 
 ПДП
 
 КРП
 
 ОЗУ
 
 УВВ
Типы источников
 
 AEN
 BALE
 -DACK
 DRQ(1)
 -I/O CH CK
 I/O CH RDY
 -I/O CS16
 -I/OR
 -I/OW
 IRQ(2)
 LA
 -MASTER
 -MEM CS16
 -MEMR
 -MEMW
 OSC
 -REFRESH
 RESET DRV(3)
 SA(7..0)
 SA(15..8)
 -SBHE(4)
 SD
 -SMEMR
 -SMEMW
 SYSCLK
 T/C
 -OWS

  
  -
 (6)
  -
  -
  П
  -
  Х
  -
  -
  П
  -
  -
  Х
  -
  -
  И
  -
  И
  -
  -
  -
  -
 (5)
  -
  И
  -
  -


  
  Х
  П
  П
  И
  И
  И
  Х
  -
  -
  И
  -
  И
  Х
  П
  -
  П
 (7)
  П
  П
  -
  -
  -
  П
  -
  П
  -
  -              
  
  Х
  -
  И
  П
  -
  -
  Х
  -
  -
  -
  -
  П
  Х
  -
  -
  -
  -
  П
  -
  -
  -
  -
  -
  -
  П
  -
  -
  
  -
  -
  -
  -
  -
  П
  Х
  -
  -
  -
  -
  -
  Х
  И 
  -
  -
  П
  -
  И
  -
  -
  -
  -
  -
  -
  -
  -
  
  -
  П
  -
  -
  И
  И
  Х
  -
  -
  -
  -
  -
  Х
  П
  -
  -
  П
  -
  П
  -
  -
  -
  П
  -
  П
  -
  -
  
  Х     
  П
  П
  И
  И
  И
  Х
  -
  -
  И
  -
  -
  Х
  -
  -
  -
  -
  П
  П
  -
  -
  -
  -
  -
  -
  -
  -
  


 
 ТТЛ
 ТТЛ 
 ТТЛ 
 ТТЛ
 ОК
 ОК
 ОК
 ТРИ
 ТРИ
 ТТЛ
 ТРИ
 ОК
 ОК
 ТРИ
 ТРИ
 ТТЛ
 ОК
 ТТЛ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТРИ
 ТТЛ
 ОК   

В этой таблице приняты следующие условные обозначения: центральный процессор – ЦП, внешние платы – ВП, контроллер ПДП – ПДП, контроллер регенерации памяти – КРП, ОЗУ на материнской плате – ОЗУ, устройства ввода/вывода на материнской плате – УВВ. Типы источников сигналов обозначаются так: ТТЛ – выход микросхемы транзисторно транзисторной логики, ОК – открытый коллекторный выход, ТРИ – выход микросхемы с тремя допустимыми состояниями на выходе.

Знаком “-” показывается, что этот сигнал для данного устройства либо запрещен, либо для этого устройства он безразличен.

Знак “X” означает, что сигнал может быть выработан этим устройством, но он будет игнорироваться другими устройствами.

(1) – DRQ может быть выдан на шину, но он не будет восприниматься как активный, до тех пор, пока контроллер ПДП является задатчиком на шине.

	(2) – эти сигналы принимаются ЦП через контроллер прерываний, но анализируются им только тогда, когда ЦП становится задатчиком на шине.

	(3) – этот сигнал может быть выработан в любое произвольное время и он всегда будет действующим.

	(4) – этот сигнал всегда принимается и анализируется перестановщиком байтов данных.

	(5) – вырабатывается устройствами на материнской плате в том случае, если требуется обращение к памяти в пределах 1-го мегабайта адресного пространства.

	(6) – вырабатывается как разрешенный материнской платой для всего цикла. 

	(7) – в данном случае разрешается внешней платой, осуществившей захват шины.
























Глава 3.                                                         Общее описание шины



3.1.	Адресное пространство при обращении к памяти


Максимальное адресное пространство при обращении к памяти, поддерживаемое шиной ISA, 16 Мегабайт(24 линии адреса), но не все слоты поддерживают полнстью это адресное пространство. Когда задатчик на шине осуществляет доступ к памяти на материнской плате или к памяти, установленной в слот, он должен разрешать сигналы –MEMR или  -MEMW; аппаратно на материнской плате дополнительно разрешаются сигналы –SMEMR и –SMEMW, если требуемый адрес находится в пределах первого мегабайта адресного пространства. К 8-ми разрядным слотам подведены только линии –SMEMR и –SMEMW, SD<7..0> и SA<19..0>; поэтому внешние платы, установленные в 8-ми разрядные слоты, могут быть только 8-ми разрядными устройствами ввода/вывода, либо 8-ми разрядной памятью в первом мегабайте адресного пространства. Внешние платы, устанавливаемые в 8/16-разрядные слоты, принимают все командные сигналы, адреса и данные; они могут быть как 8-ми так и 16-ти разрядными и адресное пространство памяти на них может быть любым в пределах 16 мегабайт. Цикл доступа к таким внешним платам завершается как 16-ти разрядный, если плата разрешает сигнал –IO CS16 или        –MEM CS16.

(+) ПРИМЕЧАНИЕ: Память на материнской плате или внешней плате считается 16-ти разрядным ресурсом только в том случае, если разрешается сигнал –MEM CS16. Этот сигнал вырабатывается из сигналов адреса LA<23..17>; поэтому 16-ти разрядная память может быть выбрана только блоками по 128 килобайт; внутри такого блока память не может быть частично 8-ми разрядной, а частично 16-ти разрядной, так как невозможно по обращению к меньшему блоку одназначно выработать сигнал –MEM CS16. Разрядность внутри такого блока должна быть одинаковой при обращении по любому адресу внутри 128 килобайт.

(!) ВНИМАНИЕ! Микросхемы динамической памяти требуют циклов регенерации через каждые 15 микросекунд. Если циклы регенерации выполняются реже, чем через 15 микросекунд, то данные в памяти могут быть потеряны.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Динамическая память на материнской плате может иметь организацию двух видов – 16-ти разрядную или 32-разрядную. Но разрядность памяти на материнской плате принимается во внимание только центральным процессором, для внешних плат динамическая память на материнской плате всегда только 16-ти разрядная. ПЗУ на материнской плате, содержащее BIOS(Base Input/Output System – Бзовая Система Ввода/Вывода), также всегда 16-ти разрядное.


3.2.	Адресное пространство для устройств ввода/вывода


Максимальное адресное пространство для устройств ввода/вывода, поддерживаемое шиной ISA, составляет 64 килобайта (16 адресных линий). Все слоты поддерживают 16 адресных линий. Первые 256 адресов зарезервированы для устройств, расположенных, как правило, на материнской плате – регистры контроллера ПДП, контроллера прерываний, часов реального времени, таймера-счетчика и других устройств, требующихся для AT совместимости различных компьютеров.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Несмотря на то, что для выбора адреса УВВ доступны все 16 сигналов адреса, традиционно для адресов УВВ в компьютерах серии IBM PC/XT/AT использовались только первые 10 разрядов адреса. Это означает, что адреса из следующих килобайтных блоков будут декодироваться также как адреса в первом килобайте адресов УВВ. Поэтому для вновь разрабатываемых внешних плат следует использовать “окна” в существующем сейчас распределении адресов стандартных УВВ для компьютеров IBM PC/AT. Для увеличения количества используемых адресов УВВ(при необходимости) можно использовать адресное пространство выбранного “окна” со сдвигом на 1 килобайт или кратное ему значение. Очевидно, что внешняя плата в этом случае должна декодировать более чем 10 разрядов адреса. В приложении 1 приведены адреса стандартных УВВ для компьютеров типа IBM PC/AT.


3.3	  Структура прерываний


Линии запроса на прерывания непосредственно заведены на контроллеры прерываний типа Intel 8259A(КР1810ВН59А). Контроллер прерываний будет реагировать на запрос по такой линии в случае,если сигнал на ней изменится с низкого уровня на высокий. Шина ISA не имеет линий, подтверждающих прием запроса на прерывание, поэтому запрашивающее прерывание устройство должно само определить по реакции ЦП подтверждение приема своего запроса. До получения подтверждения приема прерывания на линии запроса на прерывания должен сохраняться высокий уровень.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Линии запроса на прерывания заведены на все слоты и обрабатываются контроллером прерывания по нарастающему фронту сигнала. До установки новой внешней платы, если она использует в своей работе контроллер прерываний, следует определить, есть ли свободная линия запроса на прерывание и именно ее использовать для новой внешней платы. При не соблюдении этого условия возможно возникновение конфликтных стуаций на шине.


3.4.	Перестановщик байтов


Центральный процессор или внешняя плата могут выполнить как   8-ми так и 16-ти разрядные циклы доступа, причем все циклы всегда начинаются как 16-ти разрядные, а завершаются как 8-ми или 16-ти разрядные. Цикл доступа будет завершен как 8-ми разрядный, если устройство, к которому осуществляется доступ запретит сигнал –I/O CS16 или –MEM CS16. 


                      SD<15..8> Старший байт





			     SD<7..0> Младший байт	
					
                             Рис. 3.1.

Перестановщик байтов всегда находится на материнской плате. Его задача – точно согласовать размер данных, которыми обмениваются устройства. На рисунке 3.1. показано место перестановщика данных между задатчиком и ресурсом, к которому осуществляется доступ. В таблице 3.-1. представлена вся информация по перестановке байтов во время циклов доступа.

Перестановка байтов осуществляется с шины SD(15..8)(HIGH BYTE – старший байт) на SD<7..0>(LOW BYTE – младший байт) или наоборот. В таблице перенос байта с шины SD<15..8> на SD<7..0> обозначается как  H > L, наоборот – L < H. LL означает, что байт по младшей половине шины данных не переставляется. HH – что байт по старшей половине шины не переставляется. HH/LL – и старший и младший байт передаются каждый по своей половине шины данных и не переставляются.

На рисунке 3.2. показано место перестановщика байтов для циклов пересылки данных в режимах ПДП. В таблице 3-2. представлена вся информация по перестановке байтов во время циклов ПДП. Перестановка байтов осуществляется с шины SD<15..8>(HIGH BYTE) на SD<7..0>(LOW BYTE) или наоборот. В таблице перенос байта с шины SD<15..8> на SD<7..0> обозначается как  H > L, наоборот – L < H. LL означает, что байт по младшей половине шины данных не переставляется. HH – что байт по старшей половине шины не переставляется. HH/LL – и старший и младший байт передаются каждый по своей половине шины данных и не переставляются.
 


Табл. 3-1.

Задатчик на шине
Ресурс, к которому осуществляется доступ

    Завершение цикла
Размер данных
-SBHE
SA0
Размер данных
CS16
Размер данных
Маршрут






чтение
запись
8

  1
  0
  1
  0
  
  0
  1
  0
  1
8
8
16
16
1
1
0
0
8
8
8
8
LL
H<L
LL
HH
  LL
H>L
LL
HH
16
0
0
0
0
8
16
1
0
8
16
  LL
HH/LL
  LL
HH/LL

(+) ПРИМЕЧАНИЕ: задатчик на шине всегда 16-ти разрядный, но  может выполнять 8-ми разрядные циклы доступа

			        									                             SD<15..8> Старший байт



			 
                              SD<7..0> Младший байт
                 
         Рис. 3.2.
																		                          
Табл. 3-2.
Устройство ввода/вывода
Контроллер ПДП
Завершение цикла
Размер данных
-SBHE
SA0
Размер данных
-MEM
CS16
Размер данных
Маршрут






чтение
запись
8

  1
  1
  X
  X
  
  0
  0
  1
  1
8
16
8
16
1
0
1
0
8
8
8
8
LL
LL
LL
H>L
LL
LL
LL
H<L
16
0
0
0
0
8
16
1
0
8
16
Запрещено
HH/LL     HH/LL































Глава 4.                         Описание сигналов на шине ISA



В этой главе описываются все сигналы на шине ISA. Для лучшего понимания функционирования шины целесообразно разбить все сигналы на 7 групп: Адреса, Данные, Синхросигналы, Командные сигналы, Сигналы режима ПДП, Центральные сигналы управления, Сигналы прерывания, Питание. Информация о направленности сигналов (вход, выход или двунаправленный) приводится относительно задатчика на шине.


4.1.	Сигналы адреса


Группа сигналов адреса включает в себя адреса, вырабатываемые текущим задатчиком на шине. На шине ISA есть два вида сигналов адреса, SA<19..0> и LA<23..17>.


SA<19..0> [8][8/16]


Адресные сигналы этого типа поступают на шину с регистров адреса, в которых адрес “защелкивается”. Сигналы SA<19..0> позволяют осуществлять доступ к памяти только в младшем мегабайте адресного пространства. При доступе к устройству ввода/вывода только сигналы SA<15..0> имеют действительное значение, а состояние сигналов SA<19..16> не определено.

Во время выполнения циклов регенерации адреса только сигналы SA<15..0> имеют действительное значение, а состояние сигналов SA<19..8> неопределено и эти выводы должны быть в третьем состоянии для всех устройств на шине.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Внешняя плата, ставшая задатчиком на шине, должна разрешать сигнал –REFRESH для регенерации памяти, при этом внешняя плата должна перевести свои выходные формирователи сигналов адреса в третье состояние.


LA<23..17> [8/16]


Сигналы алреса этого типа поступают на шину без “защелкивания” в регистрах. Когда центральный процессор является задатчиком на шине, то значения сигналов на линиях LA<23..17> истинны во время выработки сигнала BALE и они имеют произвольное значение в конце цикла доступа. Если задатчиком на шине является контроллер ПДП, сигналы LA<23..17> истинны до начала сигнала –MEMR или –MEMW и сохраняются до конца цикла. При выполнении циклов доступа к памяти сигналы LA<23..17> всегда истинны, а при доступе к устройствам ввода/вывода эти сигналы имеют уровень логического “0”.

При выполнении циклов регенерации состояние линий LA<23..17> неопределено и все ресурсы на шине должны поддерживать свои выходы по этим линиям в третьем состоянии.

(/) РЕКОМЕНДАЦИИ: Для “защелкивания” сигналов LA следует использовать только регистры с потенциальным входом. Это вызвано тем, что в этом случае новый истинный адрес появится на выходе регистра по началу сигнала BALE (а не по его заднему фронту) и, кроме этого, во время циклов доступа к памяти каким-либо другим задатчиком, а не ЦП, сигнал BALE поддерживается в состоянии логической “1” и регистр с потенциальным входом станет просто повторителем сигналов LA (что и требуется в таком случае). Наиболее удобный регистр для “защелкивания” сигналов LA – КР1533ИР33.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если внешняя плата является задатчиком на шине, то сигналы LA<23..17> должны быть истинны до начала сигнала –MEMR или     -MEMW и сохраняться таковыми до завершения цикла. Если внешняя плата разрешает сигнал –REFRESH (следует помнить, что внешняя плата может это сделать, только будучи задатчиком на шине), то вырабатывать сигналы адреса будет контроллер регенерации, поэтому внешней плате следует перевести свои адресные выходы в третье состояние.


-SBHE [8/16]


Сигнал –SBHE(System Bus High Enable – разрешение старшего байта на системной шине) разрешается центральным процессором для указания всем ресурсам на магистрали о том, что по линиям SD<15..8> пересылается байт данных. Сигналы –SBHE и SA0 используются для определения того, какой байт и по какой половине шины данных пересылается (в соответствии с таблицей 3-1.).

Сигнал –SBHE не вырабатывается контроллером регенерации при захваие им шины, так как никаких перестановок байтов нет и нет реального чтения данных.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если внешняя плата становится задатчиком на шине, то она должна вырабатывать сигнал –SBHE так же, как и центральный процессор. 
Если внешняя плата, являющаяся задатчиком на шине, вырабатывает сигнал –REFRESH, то ее выход сигнала –SBHE должен быть переведен в третье состояние.


BALE [8][8/16]


Сигнал BALE(Bus Address Latch Enable – разрешение на “защелкивание” адреса на шине) является стробом для записи адреса по линиям LA<23..17> и сообщает ресурсам на шине, что адрес является истинным и его можно “защелкнуть” в регистре. Этот сигнал также информирует ресурсы на шине о том, что сигналы SA<19..0> и –SBHE истинны.

При захвате шины контроллером ПДП сигнал –BALE всегда равен логической “1”(вырабатывается на материнской плате), так как сигналы LA<23..17> и SA<19..0> истинны до выработки командных сигналов. Если контроллер регенерации становится задатчиком на шине, то на линии BALE также поддерживается уровень логической единицы, поскольку сигналы адреса SA<7..0> истинны до начала командных сигналов.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ При захвате шины внешней платой сигнал BALE поддерживается материнской платой в состоянии логической “1” на все время захвата шины. Адресные сигналы LA<23..7> и SA<19..0> должны быть при этом истинны в течении времени разрешения платой командных сигналов.
Если центральный процессор является задатчиком на шине и выполняет цикл доступа к ресурсу на внешней плате, то сигналы LA<23..17> истинны только в течении короткого времени, поэтому сигнал BALE должен быть использован для “защелкивания” адреса в регистре. При захвате шины любым устройством, кроме ЦП, на линии BALE поддерживается уровень логической “1”.


AEN [8][8/16]


Сигнал AEN(Address Enable – разрешение адреса) разрешается тогда, когда контроллер ПДП становится задатчиком на шине и сообщает всем ресурсам на шине о том, что на шине выполняются циклы ПДП. Разрешенный сигнал AEN также информирует все устройства ввода/вывода о том, что контроллер ПДП установил адрес памяти и УВВ следует запретить на время сигнала AEN декодирование адреса.

Этот сигнал запрещается, если задатчиком на шине является центральный процессор или контроллер регенерации.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если внешняя плата, выполняя процедуру захвата шины, вырабатывает сигнал –MASTER, сигнал AEN запрещается контроллером ПДП для того, чтобы позволить внешней плате доступ к устройствам ввода/вывода.


SD<7..0> [8][8/16] и SD<15..8> [8/16]


Линии SD<7..0> и SD<15..8>, как правило, еще называют шиной данных, причем по линии SD15 передается старший значащий бит, а по линии SD0 младший значащий бит. Линии SD<7..0> - младшая половина шины данных, SD<15..8> - старшая половина шины данных. Все 8-ми разрядные ресурсы могут обмениваться данными только по младшей половине шины данных. Поддержка обмена данными между 16-ти разрядным задатчиком на шине и 8-ми разрядным ресурсом осуществляется перестановщиком байтов на материнской плате (таблица 3-1. и рисунок 3.1. иллюстрируют его работу).

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если сигнал –REFRESH разрешен, то внешние платы должны перевести свои выходы по шине данных в третье состояние, так как нет пересылок данных во время циклов регенерации памяти.








4.2.	Командные сигналы


Сигналы этой группы управляют как продолжительностью, так и типами циклов доступа, выполняемых на шине. Группа состоит из шести командных сигналов, двух сигналов готовности и трех сигналов, которые определяют размеры и тип цикла.

Командные сигналы определяют вид устройства (память или УВВ) и направление пересылки (запись или чтение).

Сигналы готовности управляют продолжительностью цикла доступа, укорачивая его или, наоборот, удлиняя.


-MEMR [8/16] и –SMEMR [8][8/16]


Сигнал –MEMR(Memory Read – чтение памяти) разрешается задатчиком на шине для чтения данных из памяти по адресу, определяемому сигналами по линиям LA<23..17> и SA<19..0>. Сигнал     -SMEMR(System Memory Read – системное чтение памяти) функционально идентичен –MEMR, за исключением того, что сигнал –SMEMR разрешается при чтении памяти, находящейся в пределах первого мегабайта адресного пространства. Сигнал –SMEMR вырабатывается на материнской плате из команды –MEMR и, поэтому, задерживается относительно сигнала –MEMR на 10 или менее наносекунд.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если внешняя плата становится задатчиком на шине, то она может разрешать только сигнал –MEMR, так как сигнал –SMEMR может разрешаться только материнской платой при чтении из памяти в первом мегабайте адресного пространства. Если внешняя плата разрешает сигнал –REFRESH, то она должна перевести свой выход по сигналу –MEMR в третье состояние, так как после разрешения сигнала –REFRESH контроллер регенерации будет разрешать этот сигнал.


-MEMW [8/16] и –SMEMW [8][8/16]


Сигнал –MEMW(Memory Write – запись в память) разрешается задатчиком на шине для записи данных в память по адресу, определяемому сигналами по линиям LA<23..17> и SA<19..0>. Сигнал        -SMEMW(System Memory Write – системная запись в память) функционально идентичен –MEMW, за исключением того, что сигнал -SMEMW разрешается при записи в память, находящейся в пределах первого мегабайта адресного пространства. Сигнал –SMEMW вырабатывается на материнской плате из сигнала –MEMW и, поэтому, задерживается относительно сигнала –MEMW на 10 или менее наносекунд.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если внешняя плата становится задатчиком на шине, то она может разрешать только сигнал –MEMW, так как сигнал –SMEMW может разрешаться только материнской платой при записи в память в первом мегабайте адресного пространства. Если внешняя плата разрешает сигнал –REFRESH, то она должна перевести свой выход по сигналу –MEMW в третье состояние.


-I/OR [8][8/16]


Сигнал I/OR(I/O Read – чтение устройства ввода/вывода) разрешается задатчиком на шине для чтения данных из устройства ввода/вывода по адресу, определяемому сигналами SA<15..0>.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если внешняя плата разрешает сигнал –REFRESH, то она должна перевести свой выход по сигналу –I/OR в третье состояние.


-I/OW [8][8/16]


Сигнал I/OW(I/O Write – запись в устройство ввода/вывода) разрешается задатчиком на шине для записи данных в устройство ввода/вывода по адресу, определяемому сигналами SA<15..0>.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если внешняя плата разрешает сигнал –REFRESH, то она должна перевести свой выход по сигналу –I/OW в третье состояние.


-MEM CS16 [8/16]


Сигнал –MEM CS16(Memory Cycle Select – выбор цикла для памяти) разрешается 16-ти разрядной памятью для сообщения задатчику шины о том, что память, к которой он обращается, имеет 16-ти разрядную организацию и ему следует выполнить 16-ти разрядный цикл доступа. Если этот сигнал запрещен, то только 8-ми разрядный цикл доступа может быть выполнен на шине. Память, к которой выполняется цикл доступа, должна выработать этот сигнал из адресных сигналов LA<23..17>.

(+) ПРИМЕЧАНИЕ: Контроллер ПДП и контроллер регенерации игнорируют сигнал –MEM CS16 при выполнении циклов ПДП и регенерации памяти.

(/) РЕКОМЕНДАЦИИ: Декодировав сигнал LA на внешней плате 16-ти разрядной памяти, следует разрешить сигнал –MEM CS16, если установленный на шине адрес является адресом этой внешней платы. Так как этот сигнал фиксируется на материнской плате, как правило, по заднему фронту сигнала BALE, то схема дешифрации сигналов LA и последуещего формирования –MEM CS16 должна иметь минимально возможную задержку (для компьютеров с тактовой частотой ЦП 20 МГц не более 20 наносекунд).

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ Если внешняя плата является 16-ти разрядной памятью, то она должна информировать об этом задатчика на шине, разрешив сигнал –MEM CS16. Если внешняя плата, являясь задатчиком на шине, выработает сигналы адреса SA<15..0> и какое-либо устройство ввода/вывода случайно при декоддировании этого адреса разрешения сигнал –I/O CS16, то внешняя плата должна игнорировать его в течение цикла доступа к памяти.



-I/O CS16[8/16]


Сигнал –I/O CS16 (I/O Cycle Select – Выбор Цикла для УВВ) разрешается 16-разрядным УВВ для сообщения задатчику шины о том, что УВВ, к которому он обращается, имеет 16-разрядную организацию и ему следует выполнять 16-разрядный цикл доступа. Если этот сигнал запрещен, то только 8-разрядный цикл доступа к УВВ может быть выполнен на шине. УВВ, к которому выполнялся цикл доступа, должна выработать этот сигнал из адресных сигналов SA<15..0>.

(+) ПРИМЕЧАНИЕ: Контроллер ПДП и контроллер регенерации игнорируют сигнал –I/O CS16 при выполнении циклов ПДП и регенерации памяти.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Если внешняя плата является 16-разрядным УВВ, то она должна информировать об этом задатчика на шине, разрешив сигнал –I/O CS16. Если внешняя плата; являясь задатчиком на шине, выработает сигналы адреса LA<23..17> и какое-либо устройство памяти случайно при декодировании этого адреса разрешит сигнал –MEM CS16, то внешняя плата должна игнорировать его в течение цикла доступа к УВВ.


-I/O CH RDY [8][8/16]

	
Сигнал –I/O CH RDY (I/O Channel Ready – Готовность Канала Ввода/вывода) является асинхронным сигналом, вырабатываемым тем устройством, к которому осуществляется доступ на шине. Если этот сигнал запрещен, то цикл доступа удлинняется, так как в него будут добавлены такты ожидания на время запрещения. Когда задатчиком на шине является центральный процессор или внешняя плата, то каждый такт ожидания по длительности равен половине периода частоты SYSCLK (для тактовой частоты SYSCLK = 8 МГц, длительность такта ожидания – 62.5 наносекунды). Если задатчиком на шине является контроллер ПДП, то каждый такт ожидания – один период SYSCLK (для SYSCLK = 8 МГц – 125 наносекунд). При обращении к памяти на внешней плате ЦП всегда автоматически вставляет один такт ожидания (если сигнал –OWS запрещен), поэтому, если внешней плате достаточен цикл с одним тактом ожидания, то запрещать сигнал –I/O CH RDY не требуется.

(+) ПРИМЕЧАНИЕ: При выполнении циклов ПДП устройства ввода/вывода не должны вырабатывать этот сигнал, так как УВВ разрешает сигнал DRQ только после того, как истинные данные могут быть приняты или посланы УВВ и необходимости в дополнительном управлении длительностью цикла по сигналу  I/O CH RDY нет. Только устройства памяти во время циклов ПДП могут разрешать этот сигнал.

(!) ВНИМАНИЕ! Сигнал –I/O CH RDY не может быть запрещен на время больше, чем 15 микросекунд, так как при нарушении этого требования возможна потеря данных в микросхемах динамической памяти.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Если внешняя плата является задатчиком на шине, то она должна принимать и анализировать сигнал I/O CH RDY при выполнении ей циклов доступна к другим ресурсам. При работе внешней платы в других режимах она должна разрешать этот сигнал в том случае, когда она готова завершить цикл.

(!) ВНИМАНИЕ! К сожалению, некоторые внешние платы, став задатчиком на шине, игнорируют сигнал I/O CH RDY и выполняют все циклы доступа как обычные циклы доступа к 8-ми или 16-ти разрядной памяти. Поэтому, устанавливая в компьютер внешнюю плату, которая требует удлинения цикла доступа по сигналу I/O CH RDY, следует обязательно убедиться в отсутствии в компьютере такой некорректно разработанной внешней платы.


-0WS [8][8/16]

	
Сигнал –0WS (O Wait States – 0 Тактов Ожидания) является единственным на всей шине сигналом, который требует, при приеме его задатчиком на шине синхронизации с частотой SYSCLK. Он разрешается ресурсом, к которому осуществляется доступ центральным процессором или внешней платой, и информирует задатчик на шине о том, что цикл доступа должен быть завершен без вставки такта ожидания.

(+) ПРИМЕЧАНИЕ: Несмотря на то, что этот сигнал присоединяется к слоту для 8-ми разрядных плат, он не может быть использован 8-ми разрядным ресурсом. Он может быть использован только при доступе к 16-ти разрядной памяти, установленной в [8/16] слот, когда центральный процессор или внешняя плата являются задатчиком на шине. Этот сигнал игнорируется при доступе к УВВ или когда контроллер ПДП или контроллер регенерации являются задатчиком на шине.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Если внешняя плата является задатчиком на шине, то она должна принимать сигнал –0WS от ресурсов к которым она осуществляет доступ без дополнительных тактов ожидания. Когда внешняя плата является 16-ти разрядной памятью, то она должна разрешать сигнал –0WS, если быстродействие этой памяти позволяет выполнять циклы доступа к ней без вставки дополнительного такта ожидания.

(!) ВНИМАНИЕ! К сожалению, некоторые внешние платы, став задатчиком на шине, игнорируют сигнал –0WS и выполняют все циклы доступа к 8-ми или 16-ти разрядной памяти.


-REFRESH [8][8/16]

	
Сигнал –REFRESH (Refresh - Регенерация) разрешается контроллером регенерации для информирования всех устройств на шине с том, что выполняются циклы регенерации памяти.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Если внешняя плата является задатчиком на шине, то она должна разрешать сигнал –REFRESH для запроса на регенерацию памяти. При этом цикл регенерации будет выполнен даже не смотря на то, что контроллер регенерации не является задатчиком на шине.




4.3. Центральные сигналы управления.

	
Группа центральных сигналов управления состоит из сигналов различных частот, сигналов управления и ошибок.


-MASTER [8/16]

	
Сигнал –MASTER (Master – ведущий) должен вырабатываться только той внешней платой, которая желает стать задатчиком на шине.

(!)ВНИМАНИЕ! Если сигнал –MASTER разрешен на время более 15 микросекунд, то внешняя плата должна запросить цикл регенерации памяти, разрешив сигнал –REFRESH.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Сигнал –MASTER разрешается внешней платой, становящейся задатчиком на шине, только после приема ей соответствующего сигнала –DACK от контроллера ПДП. После того, как сигнал  –MASTER  будет разрешен, внешняя плата должна ждать минимум один период частоты SYSCLK, прежде чем начать выработку сигналов адреса и данных и минимум два периода SYSCLK до выработки командных сигналов


-I/O CH CK [8][8/16]

	
Сигнал –I/O CH CK (I/O Channel  Check – Проверка Канала Ввода/вывода) может быть разрешен любым ресурсом на шине как сообщение о фатальной ошибке, которая не может быть исправлена. Типичный пример такой ошибки – ошибка четности при доступе к памяти. Сигнал –I/O CH CK должен быть разрешен на время не менее 15 наносекунд. Если в момент выработки этого сигнала задатчиком на шине является контроллер ПДП или контроллер регенерации, то сигнал –I/O CH CK будет записан в регистр на материнской плате, а обработан только после того, как центральный процессор станет задатчиком на шине.
	
	Этот сигнал, как правило, соединен со входом немаскированного прерывания ЦП и его выработка приводит к прекращению нормальной работы компьютера.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Если сигнал –I/O CH CK разрешается в тот момент, когда задатчиком на шине является вынешняя плата, то он записывается в регистр на материнской плате и будет обработан только после захвата шины центральным процессором.


RESET DRV [8][8/16]

	
Сигнал RESET DRV (Reset Driver – Сброс Устройства) вырабатывается центральным процессором для начальной установки всех ресурсов доступа на шине после включения источника питания или падения его напряжения. Минимальное время разрешения этого сигнала – 1 микросекунда.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Внешние платы на все время выработки этого сигнала RESETDRV должны перевести свои выходы в третье состояние


SYSCLK [8][8/16]

	
Сигнал SYSCLK (System Clock – Системная Частота) в данной книге принимается равной 8 МГц, хотя, как правило, эта частота такая же, как и тактовая частота центрального процессора на материнской плате, но с 50% (по длительности) уровнем логической “1”. Все циклы шины пропорциональны SYSCLK, но все сигналы на шине, за исключением –0WS, не синхронизированы с SYSCLK.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Когда внешняя плата является задатчиком на шине, она может использовать SYSCLK  для задания длины цикла, но кроме как для выработки –0WS любой сигнал для синхронизации может быть использован.


OSC [8][8/16]

	
Сигнал OSC вырабатывается материнской платой всегда фиксированной частотой 14.3818 МГц с 45-50% (по длительности) уровнем логической “1”. Сигнал OSC не синхронизирован ни с SYSCLK, ни с каким либо другим сигналом на шине и поэтому не может быть использован для применений, требующих синхронизации с другими сигналами. Исторически этот сигнал появился для поддержки первых контроллеров цветных мониторов для персональных компьютеров серии IBM PC. Этот сигнал удобен для использования внешними платами, поскольку он одинаков для всех моделей компьютеров, совместимых с IBM PC/AT.



4.4. Сигналы прерывания.


	Группа сигналов прерывания используется для запроса на прерывание центрального процессора.

(+) ПРИМЕЧАНИЕ: Обычно сигналы запроса на прерывание подключены к контроллеру прерываний типа Intel 8559 A (отечественный аналог КР1810ВН59А). Несмотря на то, что доступ к контроллерам прерываний (как к УВВ) имеет любой задатчик на шине, для совместимости программного обеспечения только центральный процессор может обслуживать контроллер прерываний.


IRQ<15,14,12,11,10> [8/16]
IRQ<9,7..3> [8][8/16]

	
Прерывание может быть запрошено ресурсами как на материнской плате, так и на внешних платах разрешением соответствующего сигнала IRQ. Сигнал должен оставаться разрешенным до подтверждения прерывания центральным процессором, которое, как правило, заключается в доступе ЦП к ресурсу, запросившему прерывание.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Запрос на прерывание записывается в триггер в контроллере прерываний по нарастающему фронту сигнала запроса на прерывание и должен вырабатываться микросхемами с обычными ТТЛ выходами. Поэтому, выбирая линию запроса на прерывание для своей внешней платы, следует убедиться, что эта линия не занята какой либо другой внешней платой.


4.5. Сигналы режима ПДП.


	Эти сигналы поддерживают циклы пересылки данных при прямом доступе в память.

	(+) ПРИМЕЧАНИЕ: Каналы ПДП <3..0> поддерживают только пересылки 8-ми 	разрядных данных. Каналы ПДП <7..5> поддерживают пересылки только 16-ти 	разрядных данных.


DRQ<7..5,0> [8/16]
DRQ<3,2,1> [8][8/16]

	
Сигналы DRQ (DMA Request – Запрос на ПДП) разрешаются ресурсами на материнской плате или внешними платами для запроса на обслуживание контроллером ПДП или для захвата шины. Сигнал DRQ должен быть разрешен до тех пор, пока контроллер ПДП не разрешит соответствующий сигнал –DACK

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Сигналы DRQ вырабатываются обычными ТТЛ микросхемами, поэтому при установке внешней платы в слот шины ISA следует правильно выбрать канал ПДП, который не должен быть занят другими внешними платами.


-DACK<7..5,0> [8/16]
-DACK<3,2,1> [8][8/16]

	
Сигналы –DACK (DMA Acknowledge – Подтверждение ПДП) разрешаются контроллером ПДП как подтверждение сигналов запросов DRQ<7..5, 3..0>. Разрешение соответствующего сигнала –DACK означает, что либо циклы ПДП будут начаты, либо внешняя плата захватила шину.


T/C [8][8/16]

	
Сигнал T/C (Terminal Count – Окончание Счета) разрешается контроллером ПДП тогда, когда по какому-либо из каналов ПДП будет окончен счет числа пересылок данных, то есть все пересылки данных выполнены.




4.6. Питание.

	
Для питания внешних плат на шине ISA используется 5 напряжений питания постоянного тока: +5В, -5В, +12В, -12В, 0В (Корпус - Ground). Все линии питания заведены на 8-ми разрядный разъем, кроме одной линии по +5В и одной линии корпуса на дополнительном разъеме.
	
Максимально допустимые токи потребления для внешней платы по каждому напряжению питания приведены в таблице 4-1.

Таб. 4-1. Максимальные токи потребления внешней платой.
Напряжение
[8]
[8/16]
+5В
3.0A
4.5A
+12В
1.5A
1.5A
-5В
1.5A
1.5A
-12В
1.5A
1.5A

(!)ВНИМАНИЕ! Данные, приведенные в таблице 4-1 не означают, что каждая из установленных в слоты внешних плат может потреблять такие токи. Таблица информирует только о том, какие токи разрешается пропускать через разъем (разъемы) внешней платы. Общие допустимые токи потребления для всех внешних плат как правило, ограничиваются источником питания компьютера. Поэтому, до установки новой внешней платы в слот шины следует определить наличие соответствующего резерва по токам потребления для этой пдаты у источника питания компьютера.

























Глава 5.							         Циклы шины



	Циклы шины ISA всегда асинхронны по отношению к SYSCLK. Различные сигналы разрешаются и запрещаются в любое время; внутри допустимых интервалов сигналы отклика могут также быть выработаны в любое время. Исключением является только сигнал –0WS, который должен быть синхронизирован с SYSCLK.
	
На шине существуют 4 индивидуальных типа циклов: Доступ к Ресурсу, ПДП, Регенерация, Захват шины. Цикл доступа к ресурсу выполняется, если центральный процессор или внешняя плата в качестве задатчиков обмениваются данными с различными ресурсами на шине. Цикл ПДП выполяется, если контроллер ПДП является задатчиком на шине и выполняет циклы передачи данных между памятью и УВВ. Цикл регенерации выполняется только контроллером регенерации для регенерации микросхем динамической памяти. Цикл захвата шины выполняется внешней платой для того, чтобы стать задатчиком на шине.
	
Структурные циклы отличаются по типу задатчика на шине и видами ресурсов доступа на ней. Внутри типа цикла существуют различные его виды, обусловленные различной продолжительностью каждого вида. Существуют три типа цикла Доступа к Ресурсу:
цикл с 0 тактов ожидания – это цикл наиболее короткий из всех  возможных;
нормальный цикл – при выполнении такого цикла ресурс доступа                                                                                                 не  запрещает сигнал готовности I/O CH RDY – далее цикл такого вида будет называться просто нормальным;
удлиненный цикл – при выполнении такого цикла ресурс доступа запрещает сигнал готовности I/O CH RDY на время, необходимое ресурсу для приема или передачи данных – далее цикл такого вида будет называться удлиненным.

В циклах ПДП и Регенерация тоже существуют типы циклов: нормальный и удлиненный, исходя из таких же, описанных выше условий.

Ниже все типы циклов будут подробно описаны и, кроме этого, в главе 6 приведены временные диаграммы всех типов циклов.


5.1. Цикл Доступа к Ресурсу.


Центральный процессор начинает цикл Доступа к Ресурсу выработкой сигнала BALE, сообщающего всем ресурсам об истинности адреса на линиях SA<19..0>, а также для фиксации ресурсами адреса по линиям LA<23..17>. Ресурсы должны сообщать ЦП разрешением сигнала –MEM CS16 или –I/O CS16 о том, что цикл должен быть 16-ти разрядным; иначе цикл будет завершен как 8-ми разрядный. ЦП также вырабатывает сигналы –MEMR, –MEMW, -I/OR и -I/OW, определяющие тип ресурса (память или УВВ), а также направление передачи данных. Если доступ к памяти в первом мегабайте адресного пространства, то также будет разрешаться сигнал –SMEMR или –SMEMW. Ресурс доступа, которому необходимо изменить время цикла, должен отвечать сигналом -0WS или I/O CH RDY для информирования ЦП о продолжительности цикла доступа.

(*)ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Внешняя плата, захватившая шину, также начинаетцикл доступа с выработки адресных сигналов, в отличие от ЦП, не подтверждает адрес сигналом BALE. На линии этого сигнала поддерживается материнской платой уровень логической “1” на все время захвата шины внешней платой. Поэтому внешняя плата должна выработать истинные сигналы как по линиям SA<19..0>, так и по линиям LA<23..17> до начала разрешения командных сигналов, сохраняя адрес до конца цикла. Внешняя плата также должна иметь возможность анализа сигналов –MEM CS16 и I/O CS16 и в соответствии с этими сигналами завершать цикл 16-ти или 8-ми разрядный.

5.1.1. Цикл доступа к ресурсу – 0 тактов ожидания.

	Цикл доступа с 0 тактов ожидания -  наиболее короткий цикл из всех возможных на шине. Этот цикл может быть выполнен только при доступе ЦП или внешней платы (когда она задатчик на шине) к 16-ти разрядной памяти. В начале цикла задатчик должен установить адрес на линиях LA<23..17> для выбора блока памяти в 128 килобайт. Если затем не будет разрешен сигнал –MEM CS16, то цикл будет завершен как 8-ми разрядный (нормальный или удлиненный) и цикл с 0 тактов ожидания не будет выполнен. Если ресурсом будет разрешен сигнал –MEM CS16, то затем он должен разрешить сигнал –0WS в соответствующее время после выдачи командного сигнала –MEMR или –MEMW для завершения цикла с 0 тактов ожидания. При запрещении сигнала –0WS цикл завершается как нормальный или удлиненный.

(+) ПРИМЕЧАНИЕ: Если сигнал –0WS разрешается ресурсом доступа, то задатчик не требует разрешения сигнала I/O CH RDY – он игнорируется.

Только сигнал –0WS является на шине ISA синхронным по отношению к SYSCLK сигналом.

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Внешняя плата, захватившая шину, выполняет цикл доступа с 0 тактов ожидания точно также как центральный процессор.

5.1.2. Цикл досткпа к ресурсу – Нормальный цикл.

	Нормальный цикл может быть выполнен ЦП или внешней платой (если она владеет шиной) при доступе к 8-ми или 16-ти разрядному УВВ или к памяти. После выдачу на шину сигналов адреса задатчик разрешает командные сигналы –MEMR, –MEMW, -I/OR или -I/OW. В ответ ресурс должен разрешить сигнал I/O CH RDY в соответствующее время, так как иначе цикл будет завершен как удлиненный. Разрешение I/O CH RDY заставляет задатчик завершить цикл за фиксированный период времени (этот период кратен периоду SYSCLK, но не синхронизирован с ним). Длительность нормального цикла определяется временем разрешения сигналов –MEMR, –MEMW, -I/OR или -I/OW, которое, в свою очередь, зависит от размера данных и адреса ресурса доступа.

5.1.3. Цикл доступа к ресурсу – Удлиненный цикл.

	Удлиненный цикл может быть выполнен ЦП или внешней платой (если она владеет шиной) при доступе к 8-ми или 16-ти разрядному УВВ или к памяти. Задатчик на шине выполняет удлиненный цикл в том случае, если ресурс, к которому осуществляется доступ, не разрешает в соответствующее время после разрешения командного сигнала сигнал I/O CH RDY. Задатчик продолжает разрешать командный сигнал до тех пор, пока ресурс не разрешит сигнал I/O CH RDY. Период времени удлиненного цикла также кратен SYSCLK, но не синхронизирован с ним.


5.2. Цикл Регенерации.

	
Контроллер регенерации пытается захватить шину по истечени 15 микросекунд от последнего цикла регенерации двумя способами:
если шиной влвдеет центральный процессор, то он по завершении выполнения текущей команды передает шину контроллеру регенерации;
если шиной влвдеет контроллер ПДП, то шина будет передана контроллеру регенерации только по завершении циклов пересылки данных контроллером ПДП.

Назначение следующих сигналов во время цикла регенерации имеют оригинальную интерпретацию:

	-REFRESH	разрешение этого сигнала сообщает о начале цикла регенера				ции;

Адрес	контроллер регенерации вырабатывает только сигналы по линиям адреса SA<7..0>, остальные сигналы адреса не определены;

-MEMR	сигнал –MEMR разрешается контроллером регенерации, при этом сигнал –SMEMR будет разрешен материнской платой;

SD<15..0>	линии данных игнорируются контроллером регенерации и все ресурсы на шине обязаны перевести свои выходы по линиям данных в третье состояние;

-0WS	эти сигналы игнорируются контроллером регенерации.
-MEM CS16
-I/O CS16

(*) ОСОБЕННОСТИ ДЛЯ ВНЕШНИХ ПЛАТ: Когда внешняя плата является задатчиком на шине, она должна самостоятельно разрешать сигнал –REFRESH для запуска цикла регенерации памяти.

5.2.1. Цикл регенерации – Нормальный цикл.

	Нормальный цикл регенерации контроллер регенерации начинает с разрешения сигнала –MEMR, в ответ ресурс должен разрешить сигнал I/O CH RDY в соответствующее время, так как иначе цикл будет завершен как удлиненный. Длину цикла фактически определяет только продолжительность сигнала –MEMR.

5.2.2. Цикл регенерации – Удлинненый цикл.

	Удлиненный цикл контроллер регенерации выполняет в том случае, если хотя бы один ресурс доступа не разрешает сигнал I/O CH RDY в соответствующее время после разрешения сигнала –MEMR. Контроллер регенерации продолжает разрешать сигнал –MEMR до того, как сигнал I/O CH RDY будет разрешен всеми ресурсами на шине. Период времени удлиненного цикла также кратен SYSCLK, но не синхронизирован с ним.


5.3. Цикл ПДП.

	
Цикл ПДП подобен циклу доступа, который выполняет другой владелец шины. Циклы ПДП запускаются после разрешения сигнала –DACK контроллером ПДП. Размер передаваемых данных зависит от используемого канала ПДП: каналы с 0 по 3 определены для 8-ми разрядных пересылок, а каналы с 5 по 7 для 16-ти разрядных пересылок данных. Сигналы –MEM CS16 и –I/O CS16 игнорируются самим контроллером ПДП, но эти сигналы использует перестановщик байтов на материнской плате.
	
Циклы ПДП выполняются только между памятью и устройствами ввода/вывода. Сигналы адреса, вырабатываемые контроллером ПДП, содержат только адрес памяти и не содержат адрес УВВ. Процесс пересылки данных в цикле ПДП выполняется так: источник данных выставляет данные на шине, а приемник данных должен быть готов их принять в то же самое время. Команды записи и чтения также разрешаются одновременно для правильного выбора направления пересылки. При этом сигнал чтения обязательно разрешается раньше, чем сигнал записи во избежание столкновения между буферами данных в двух ресурсах.
	
УВВ, запрашивающее режим ПДП на шине, разрешает сигнал DRQ сответствкющего канала. Если задатчиком на шине является центральный процессор, то он освобождает шину контроллеру ПДП, который, в свою очередь, извещает УВВ разрешением сигнала –DACK о том, что начинается цикл ПДП. Так как контроллер ПДП вырабатывает только адрес памяти, УВВ должно использовать сигналы –I/OR, –I/OW и –DACK для приема или передачи данных в режиме ПДП.
	Цикл ПДП начинается с разрешением сигнала –DACK соответствующего канала, а также сигнала AEN. Разрешением сигнала AEN контроллер ПДП извещает все ресурсы на шине о том, что адреса и командные сигналы вырабатываются контроллером ПДП, а не центральным процессором, контроллером регенерации или внешней платой. После разрешения командных сигналов контроллер ПДП анализирует сигнал I/O CH RDY для определения длительности цикла.
	Если цикл удлиняется, то период удлинения кратен удвоенному периоду SYSCLK, хотя и не синхронизирован с SYSCLK.

(+) ПРИМЕЧАНИЕ: Данные, которые записываются в память или УВВ, должны быть истинны до разрешения команды записи и оставаться истинными до запрещения команды записи.

5.3.1. Цикл ПДП – Нормальный цикл.

	Нормальный цикл выполняется контроллером ПДП для 8-ми или 16-ти разрядных пересылок данных. Контроллер ПДП разрешает сигналы –MEMR,  –MEMW, –I/OR и –I/OW, а память, с которой выполняется обмен, должна разрешить сигнал I/O CH RDY в соответствующее время, иначе цикл будет завершен как удлиненный. Разрешение сигнала I/O CH RDY заставляет контроллер завершить цикл за фиксированный период времени; этот период кратен периоду SYSCLK, но не синхронизирован с ним.
	Продолжительность разрешения сигналов –MEMR, –MEMW, –I/OR и    –I/OW определяет продолжительность всего цикла, причем эта продолжительность зависит от размара данных для различных адресных пространств.

5.3.2. Цикл ПДП – Удлиненный цикл.

	Удлиненный цикл ПДП выполняется контроллером ПДП также, как и нормальный цикл, за исключением того, что при удлиненном цикле сигнал I/O CH RDY не разрешается в соответствующее время после того, как командный сигнал будет разрешен. Контроллер ПДП продолжает разрешать командные сигналы до тех пор, пока УВВ не разрешит сигнал I/O CH RDY. Период времени, на который удлиняется цикл, в этом случае кратен удвоенному периоду SYSCLK, хотя и не синхронен с SYSCLK.

(+) ПРИМЕЧАНИЕ: Сигналы адреса LA<23..0> во время обычного цикла доступа должны записываться в регистр ресурсами доступадля запоминания адреса в течение всего цикла. В отличие от обычных циклов, при выполнении циклов ПДП эти адресные сигналы истинны в течение всего цикла ПДП.

	(!) ВНИМАНИЕ! Каналы ПДП, которые используются внешними платами для за	хвата шины, должны быть запрограммированы в каскадном режиме.


5.2. Цикл Захвата Шины.

	
Любая внешняя плата, установленная в [8/16] слот, может стать задатчиком на шине ISA. Захват шины Внешняя плата должна начать с разрешения сигнала DRQ канала ПДП, предварительно запрограммированного в каскадный режим. Канал ПДП, запрограммированный в каскадном режиме, считает, что все циклы ПДП были выполнены внешним ресурсом – в данном случае внешней платой. Контроллер ПДП отвечает внешней плате разрешением сигнала –DACK; внешняя плата в ответ на –DACK разрешает сигнал –MASTER. После разрешения сигнала –MASTER внешняя плата должна ждать некоторое время, после чего может начинать свои циклы доступа.



























Глава 6.					                 Временные диаграммы



	В таблицах этой главы приведены временные соотношения для всех циклов, объясненных в предыдущей главе. Все времена приведены для частоты SYSCLK = 8 МГц, поэтому, если проектируемая внешняя плата должна работать в компьютерах с частотой до 16 МГц, то следует ужесточить требования к быстродействию внешней платы не менее, чем в два раза по сравнению с приведенными. Для ресурсов все времена измерены на разъеме ресурса доступа. Время в пределах 0...11 наносекунд добавлено для учета времени распространения сигнала по шине. В некоторых случаях сигнал возвращается от ресурса, который был источником сигнала, синхронизированного с возвращаемым и в этом случае добавлено 0...22 наносекунд. Время “0” означает теоретически минимально возможное время и используется только как расчетное при определении времени цикла.

(+) ПРИМЕЧАНИЕ: В таблицах и временных диаграммах приведены только сигналы –MEMR и –MEMW, а не –SMEMR и –SMEMW. Сигналы –SMEMR и –SMEMW вырабатываются с задержкой от 0 до 10 наносекунд относительно сигналов –MEMR и –MEMW в тех случаях, когда ЦП, контроллер ПДП или контроллер регенерации является задатчиком на шине. Если задатчиком на шине является внешняя плата, то задержка может быть увеличена до 22 наносекунд.

(+) ПРИМЕЧАНИЕ: Во всех таблицах временных диаграмм TCLK обозначает период тактовой частоты шины.

	Временные соотношения для циклов с 0 тактов ожидания, нормальных и удлиненных, для 16-ти и 8-ми разрядных ресурсов памяти и УВВ приведены в таблице 6-1.

Табл. 6-1.
N
Пара-метра

Наименование
Задатчик на шине (нс)
Ресурс доступа (нс)


Min
Max
Min
Max
1
LA<23..17> устанавливается до BALE
61

50

2
Ширина импульса BALE
61

50

3
LA<23..17> сохраняется после BALE
26

15

4
LA<23..17> устанавливается до команды для 16-ти разрядной памяти
120

109

5
-MEM CS16 истинный от LA<23..17>

102

66
6
-MEM CS16 удерживается после LA<23..17>
0

0

7a

b

c

d
SA<19..0> устанавливается до команды для  16-ти разрядной пямяти.
SA<19..0> устанавливается до команды для  16-ти или 8-ми разрядного УВВ.
-SBHE устанавливается до команды для  16-ти разрядной пямяти.
-SBHE устанавливается до команды для  16-ти или 8-ми разрядного УВВ.
39

102

49

112

28

91

38

101

8a


b


c


d
Длительность команд записи/чтения при доступе к 16-ти разрядной памяти (нормальный или удлиненный цикл)
Длительность команд записи/чтения при доступе к 16-ти разрядным УВВ    (нормальный или удлиненный цикл)
Длительность команд записи/чтения при доступе к 16-ти разрядной памяти                    (0 тактов ожидания цикл)
Длительность команд записи/чтения при доступе к 8-ми разрядным ресурсам (нормальный или удлиненный цикл)
250


187


125


530



239


176


114


519

9
SA<19..0> устанавливается до BALE
40

29

10a

b

c


d
Время установления данных после сигнала чтения 16-ти разрядной памяти
Время установления данных после сигнала чтения 16-ти разрядного УВВ
Время установления данных после сигнала чтения 16-ти разрядной памяти для цикла с 0 тактов ожидания
Время установления данных после сигнала чтения 8-ми разрядного УВВ

209

132

132


489

187

110

110


467
11a
Время установления данных в цикле записи в 16-ти разрядную память
Время установления данных в цикле записи в 16-ти разрядное УВВ
Время установления данных в цикле записи в 8-ми разрядный ресурс
-29

33

33

-40

22

22

12
SA<19..0>, -SBHE снимаются после командного сигнала
22

11

13a

b
Время выключения команды при доступе к 16-ти разрядному ресурсу
Время выключения команды при доступе к 8-ми разрядному ресурсу
125

187

114

176

14
Время установления данных при чтении до снятия команды
40

62

15a
b
Удержание данных при чтении
Удержание данных при записи
0
30

0
30

16
Перевод сигналов SD<15..0> в третье состояние после снятия команды

32

32
17
-0WS истинный от команды

40

18
18
-I/O CS16 истинный от SA<19..0>

126

90
19
-I/O CS16 удерживается после снятия SA<19..0>
0

0

20a

b
I/O CH RDY в лог. “0” от 16-ти разрядной команды
I/O CH RDY в лог. “0” от 8-ми разрядной команды

66

378

44

356
21
I/O CH RDY длительность в лог. “0”
TCLK
15600
TCLK
15600
22
Снятие командного сигнала после разрешения I/O CH RDY
TCLK

TCLK

23
Разрешение BALE после снятия команды
50

61

24
Период тактовой частоты (TCLK)
125
167
125
167
25
Данные устанавливаются до разрешения       I/O CH RDY


-63

26
LA<23..17> удерживается после разрешения команды обращения к памяти
41

30

27
Длительность –0WS
125

125

28
–0WS устанавливается до спада SYSCLK


10

29
–0WS удерживается после спада SYSCLK


20


(+)ПРИМЕЧАНИЕ: (1) LA<23...17> вырабатывается также как SA<19...0>, если задатчик на шине не центральный процессор.












































































































































































































































































































Временные соотношения для цикла регенерации памяти приведены в таблице 6-2.

Табл. 6-2.
N
пара-
метра

Наименование
Контроллер
регенерации
(нс)
Внешняя
Плата
(нс)


Min
Max
Min
Max
1
Длительность –MEMR/-SMEMR
250

239

2
SA<19..0> устанавливается до –MEMR
125

114

3
SA<19..0> удерживается после завершения команды
10

21

4
I/O CH RDY в лог. "0" от –MEMR/-SMEMR

81

59
5
-MEMR снимается после разрешения I/O CH RDY
125
250
125
261
6
-REFRESH устанавливается до -MEMR
250

239

7
-REFRESH удерживается после запрещения –MEMR(1)
125
250
125
211
8
SA<19..0> и –MEMR удерживаются в третьем состоянии после запрещения -MEMR

TCLK


9
Длительность лог."0" I/O CH RDY
TCLK

TCLK

10 
Задержка возвращения управления шиной после запрещения –REFRESH
2TCLK

2TCLK


	(+) ПРИМЕЧАНИЕ: (1) Сигнал –REFRESH может удерживаться длительное время 	для выполнения нескольких циклов регенерации памяти.






Временные соотношения для циклов ПДП приведены в таблице 6-3.


Табл. 6-3.
N
пара-
метра

Наименование
Контроллер
регенерации
(нс)
Внешняя
Плата
(нс)


Min
Max
Min
Max
1
-DACK, AEN устанавливаются до –I/OR, -I/OW
145

134

2
Адрес устанавливается до команды
102

91

3a
3b
-I/OR устанавливается до –MEMW
-MEMR устанавливается до –I/OW
235
30

224
19

4a
4b
Данные устанавливаются от –I/OR(1)
Данные устанавливаются от –MEMR(1)

230
261

241
272
5a
5b
Данные устанавливаются до разрешения –MEMW(1)
Данные устанавливаются до разрешения –I/OW(1)


-21
-214 

6
Команда чтения удерживается после запрещения команды записи
50

39

7
Адрес удерживается после запрещения команд
50

39

8
Данные удерживаются после запрещения 
команд (1)
50

39

9
I/O CH RDY в лог. "0" от команды обращения к памяти (1)

125

90
10
T/C устанавливается до команды
-60
60
-49
49
11
T/C удерживается после запрещения команды
-60
60
-49
49
12a
12b
Длительность –I/OR
Длительность –MEMR
700
450

689
439

13a
13b
Длительность –I/OW
Длительность –MEMW
400
650

389
639

14
-DACK удерживается после запрещения команды
60

49

15
AEN удерживается после запрещения команды
60

49

16
DRQ активный от разрешения команды

119

141
17
Длительность лог. "0" I/O CH RDY
TCLK

TCLK


(+) ПРИМЕЧАНИЕ: (1) Не для контроллера ПДП, а для внешней платы.
















Временные соотношения для цикла захвата шины приведены в таблице 6-4.

Табл. 6-4.
N
пара-
метра

Наименование
Контроллер
регенерации
(нс)
Внешняя
Плата
(нс)


Min
Max
Min
Max
1
DACK разрешается после разрешения DRQ (1) 




2
Задержка –MASTER от –DACK
0



3
Контроллер ПДП переводит свои выходы в третье состояние
0
49


4
AEN удерживается после разрешения -MASTER
0
49


5
Внешняя плата начинает вырабатывать сигналы адреса, данных и командные сигналы


60

6
Сигнал –MASTER удерживается после запрещения DRQ



100
7
Сигнал –DACK удерживается после запрещения DRQ(2)
0

0

8
Внешняя плата переводит свои выходы в третье состояние до запрещения сигнала –MASTER


0

9
ЦП начинает вырабатывать свои сигналы после запрещения сигнала –MASTER
0



10
DRQ удерживается запрещенным после запрещения 
-DACK


0



(+) ПРИМЕЧАНИЯ: (1) Точные временные интервалы определяются            контроллером ПДП. 
(2) Сигнал DRQ должен оставаться запрещенным, пока  разрешен   сигнал -DACK.






















Глава 7.                           Характеристики соединителей на шине



7.1. Назначение выводов соединителей,
устанавливаемых в слоты


	Назначение выводов соединителей показано сверху вниз (при установленной внешней плате сторона компонентов соответствует правой половине соединтелей, а место установки крепежной планки – вверху).

36-выводный [8/16] соединитель:
Сигнал
Вывод
Вывод
Сигнал
-MEM CS16
-I/O CS16
IRQ10
IRQ11
IRQ12
IRQ15
IRQ14
-DACK0
DRQ0
-DACK5
DRQ5
-DACK6
DRQ6
-DACK7
DRQ7
+5B
-MASTER
Корпус (GND)
D1
D2
D3
D4
D5
D6
D7
D8
D9
D10
D11
D12
D13
D14
D15
D16
D17
D18
C1
C2
C3
C4
C5
C6
C7
C8
C9
C10
C11
C12
C13
C14
C15
C16
C17
C18
-SBHE
LA23
LA22
LA21
LA20
LA19
LA18
LA17
-MEMR
-MEMW
SD8
SD9
SD10
SD11
SD12
SD13
SD14
SD15

62-выводный [8] соединитель:
Сигнал
Вывод
Вывод
Сигнал
Корпус (GND)
RESET DRV
+5B
IRQ9
-5B
DRQ2
-12B
-0WS
+12B
Корпус (GND)
-SMEMW
-SMWMR
-I/OW
-I/OR
-DACK3
DRQ3
-DACK1
DRQ1
-REFRESH
SYSCLK
IRQ7
IRQ6
IRQ5
IRQ4
IRQ3
-DACK2
I/O
BALE
+5B
OSC
Корпус (GND)
B1
B2
B3
B4
B5
B6
B7
B8
B9
B10
B11
B12
B13
B14
B15
B16
B17
B18
B19
B20
B21
B22
B23
B24
B25
B26
B27
B28
B29
B30
B31
A1
A2
A3
A4
A5
A6
A7
A8
A9
A10
A11
A12
A13
A14
A15
A16
A17
A18
A19
A20
A21
A22
A23
A24
A25
A26
A27
A28
A29
A30
A31
-I/O CH CK
SD7
SD6
SD5
SD4
SD3
SD2
SD1
SD0
I/O CH RDY
AEN
SA19
SA18
SA17
SA16
SA15
SA14
SA13
SA12
SA11
SA10
SA9
SA8
SA7
SA6
SA5
SA4
SA3
SA2
SA1
SA0


7.2. Электрические характеристики сигналов

	Аббревиатуры, раскрытые ниже, будут использоваться далее при рассмотрении требований к характеристикам сигналов по шине.

ТРИ	выход с тремя состояниями. Имеет состояния: активный низкий уровень, активный высокий уровень, выключено;
ТТЛ	выход транзисторно-транзисторной логики с двумя состояниями. Имеет активный низкий уровень, активный высокий уровень;
Iih	входной ток высокого уровня. Такой ток возникает тогда, когда ко входу подключен выход с активным высоким уровнем;
Iil	входной ток низкого уровня. Такой ток возникает тогда, когда ко входу подключен выход с активным низким уровнем;
Ioh	выходной ток высокого уровня. Характеризует нагрузочную способность выхода устройства в активном высоком уровне;
Iol	выходной ток низкого уровня. Характеризует нагрузочную способность выхода устройства в активном низком уровне;
Vih	входное напряжение высокого уровня;
Vil	входное напряжение низкого уровня;
Voh	выходное напряжение высокого уровня;
Vol	выходное напряжение низкого уровня;


7.3. Напряжения и токи по цепям сигналов на шине

На шине ISA могут использоваться сигналы только с трех типов устройств:
ТТЛ(транзисторно-транзисторной логики), ТРИ(трехстабильный) и ОК(открытый
коллекторный выход). Устройство с выходом ТТЛ логики может быть только
фиксированного направления – либо вход, либо выход. Устройство с тремя
состояниями может быть как входом, так и выходом, и кроме этого, находиться в
третьем состоянии.

                                Табл. 7-1. Напряжения и токи на шине.

ТТЛ
ТРИ
ОК(1)

передатчик
приемник
Передатчик
приемник
ТРИ
Передатчик
Iil
Iih
-
-
-0.8
0.04
-
-
-0.8
0.04
-0.04
0.04
-0.4(2)
0.02
Iol
Ioh
24
-3
-
-3
24
-3
-
-
0.4
-0.04
24
(3)

(+) ПРИМЕЧАНИЯ: (1) Voh=2.4 B Vih=2.7 B Vol=0.5 B Vil=0.4 B
Все токи в таблице указаны в миллиамперах. Знак "-" перед значением тока означает, что ток вытекает из внешней платы в кросс материнской платы.
(2) Линия с открытым коллекторным выходом может быть подключена к ТТЛ входу.
(3) По линии с открытым коллекторным выходом ток Ioh (ток течки) не должен превышать для каждого слота 0.4 миллиампера.

  
7.4. Дополнительные требования к приемникам и передатчикам на
внешних платах

	
Разработка собственных внешних плат требует соблюдения еще ряда условий, кроме оговоренных в таблице 7-2, а именно:

?	При проектировании топологии печатного монтажа на внешней плате, следует учитывать, что максимальная длина печатного проводника от контакта разъема до вывода подключенного к этой цепи компонента не должна превышать 65 миллиметров;
?	Для минимизации помех на шине, уменьшения переотражений следует использовать компоненты с крутизной фронта нарастания/спада выходного напряжения не хуже 3 наносекунд;
?	Максимальная емкость по каждому выводу интерфейсного разъема должна быть не более 20 пикофарад. В эту емкость входят входные емкости всех приемников и передатчиков, подсоединенных к выводу, и, кроме этого, емкость печатного проводника, связывающего вывод разъема с компонентами.

Исходя из приведенных выше требований, только входы микросхемы серий К555, КР1533 подходят для присоединения к ним сигналов с шины, причем наиболее предпочтительны микросхемы серии КР1533, так как строго говоря, если на какой-либо сигнал будут нагружены 2 входа серии К555 в каждом слоте, то это нарушит требования к нагрузке на шине по этому сигналу. Микросхемы серий К531 и КР1531 нельзя использовать для этих целей, так как их входные токи превышают допустимые.


7.5. Нагрузочные резисторы на шине


На кроссе материнской платы установлены нагрузочные резисторы для оптимизации электрических характеристик шины. Нагрузочные резисторы подключаются двумя способыми:

?	между линией сигнала и +5B;
?	последовательно между ресурсом на материнской плате и линией сигнала на шине.


Табл.7-2. Номиналы резисторов и способ подключения.
Сигнал
На +5B
Последователньно
-I/O CH CK
I/O CH RDY
-I/O CS16
I/OR
I/OW
-MASTER
-MEM CS16
-MEMR
-MEMW
OSC
-REFRESH
-SMEMR
-SMEMW
SYSCLK
-0WS
4.7 кОм
1.0 кОм
300 Ом
4.7 кОм
4.7 кОм
300 Ом
300 Ом
4.7 кОм
4.7 кОм
-
300 Ом
4.7 кОм
4.7 кОм
-
300 Ом
-
-
-
22 Ом
22 Ом
-
-
22 Ом
22 Ом
22 Ом
-
22 Ом
22 Ом
27 Ом
-

7.6. Механические характеристики внешней платы

Чертеж внешней платы с указанием всех габаритных размеров приведен на рисунке 7-1. При разработке вашей платы следует также учитывать следующее:
?	толщина платы должна быть 1.6 мм +/- 0.2 мм (с учетом толщины фольги);
?	коробление платы не должно превышать 1.3 мм на всей длине платы;
?	максимальная высота компонентов на плате не более 10 мм.






Приложение 1.


Таблица стандартных адресов портов для компьютеров IBM PC/AT и совместимых с ними. Все адреса приведены в шестнадцатеричной (HEX) системе счисления.

000-01f
Контроллер ПДП #1
020-03f
Контроллер прерываний #1
040-05f
Программируемый таймер
060-06f
Контроллер клавиатуры
070-07f
Часы реального времени, CMOS ОЗУ, маскирование немаскируемого прерывания центрального процессора, контрольная точка проверки оборудования
080-09f
Регистр страницы ПДП
0a0-0bf
Контроллер прерываний #2
0c0-0df
Контроллер ПДП #2
0f0-0ff
Математический сопроцессор
170-177
Накопитель на жестком диске (второй)
1f0-1f7
Накопитель на жестком диске
200-207
Игровой порт (джойстик)
278-27f
Принтерный порт #2 (#3 с MDA)
2c0-2df
Порты контроллера типа EGA #2
2f8-2ff
Порт контроллера последовательного интерфейса #2
300-31f
Плата прототипа
370-377
Контроллер накопителя на гибком диске (второй)
378-37f
Принтерный порт #1 (#2 с MDA)
380-38f
Порты устройства поддержки обмена данными по протоколу SDLC
3a0-3af
Бисинхронный порт #1
3b0-3df
Контроллер дисплея VGA
3b0-3bf
Монохромный Адаптер Дисплея (Monochrome Display Adapter – MDA)/Принтер #1
3c0-3cf
Улучшенный Графический Адаптер (Enhanсed Graphics Adapter – EGA)
3d0-3df
Цветной Графический Адаптер (Color/Graphics Adapter – CGA)
3f0-3f7
Контроллер накопителя на гибком диске
3f8-3ff
Порт контроллера последовательного интерфейса #1















Приложение 2.


Таблица стандартного распределения памяти для компьютеров IBM PC/AT и совместимых с ними. Все адреса приведены в шестнадцатеричной (HEX) системе счисления.

Адрес
Наименование
0000:0000
Таблица векторов прерываний: 256 4-байтных адресов
0040:0000
Область данных для программы BIOS
0050:0000
Область специальных данных для операционной системы MS-DOS
xxxx:0000
Область, занимаемая DOS и пользовательскими программами
A000:0000
EGA или VGA память для поддержки видеорежимов
B000:0000
Видеопамять MDA – Монохромного Адаптера Дисплея (также видеоадаптера типа Hercules)
B800:0000
Color Graphics Adapter (Цветной Графический Адаптер) – видеопамять (также 2 страница видеопамяти для адаптера типа Hercules)
C800:0000
до
D000:FFFF
Программы в ПЗУ периферийных устройств (например в контроллере жесткого диска или платы EGA). Эта область памяти также используется для адресации физических страниц расширенной памяти стандарта EMS
E000:0000
до
E000:FFFF
ПЗУ на материнской плате, содержащие программы BIOS
F000:FFF0
Команда JMP для старта после сброса или включения питания компьютера
F000:FFF5
Дата создания программ BIOS (в кодах ASCII)
F000:FFEE
Идентификационный код компьютера

(+) ПРИМЕЧАНИЕ: Память за адресным пространством в 1 мегабайт используется в зависимости от запросов применяемой операционной системы.


   















          
Приложение 3.



3.1. Рекомендуемые схемы приема/выработки сигналов на шине.


          





































































         Список литературы

	1) Intel ISA Bus Specification and Application Notes, June 14, 1989
	2) IAPX 286 Hardware Reference Manual, Intel Corporation, 1983
	3) IBM PC/AT Technical Reference, IBM Corporation, 1984




